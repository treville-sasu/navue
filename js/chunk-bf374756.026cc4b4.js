(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-bf374756"],{"0223":function(t,e,a){"use strict";var i=a("ae67"),o=a.n(i);o.a},"0f66":function(t,e,a){},1849:function(t,e,a){"use strict";var i=a("0f66"),o=a.n(i);o.a},"30d1":function(t,e,a){"use strict";var i=a("b7de"),o=a.n(i);o.a},3935:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{staticStyle:{height:"100%"}},[a("b-modal",{attrs:{"trap-focus":"","destroy-on-hide":"","has-modal-card":"","aria-role":"dialog","aria-modal":""},on:{"after-leave":function(e){t.tool=null}},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"modal-card"},[a("NavigationSelect",{attrs:{value:t.navigation,select:""},on:{input:function(a){e.close(),t.navigation=a}}})],1)]}}]),model:{value:t.isNavigationSelectActive,callback:function(e){t.isNavigationSelectActive=e},expression:"isNavigationSelectActive"}}),a("l-map",{ref:"movingMap",attrs:{options:{zoomSnap:.5,zoomControl:!1}},on:{ready:t.setupMap,contextmenu:t.setDestination}},[t.settings.zoomControl?a("l-control-zoom",{attrs:{position:"topleft"}}):t._e(),a("l-control-fullscreen",{attrs:{position:"topleft"}}),a("l-moving-map-toolbox-control",{attrs:{position:"bottomleft"},on:{"delete-track":t.removeLocations,"open-navigation":function(e){t.isNavigationSelectActive=!0}},model:{value:t.settings,callback:function(e){t.settings=e},expression:"settings"}}),a("l-moving-map-instruments-control",{attrs:{position:"topright"},model:{value:t.lastKnownLocation,callback:function(e){t.lastKnownLocation=e},expression:"lastKnownLocation"}}),t.lastKnownLocation&&t.destination?a("l-moving-map-destination-control",{attrs:{from:t.lastKnownLocation,to:t.destination,position:"bottomright"}}):t._e(),a("l-base-layer-group"),a("l-location-marker",{attrs:{delay:t.futurPositionDelay},model:{value:t.lastKnownLocation,callback:function(e){t.lastKnownLocation=e},expression:"lastKnownLocation"}}),t.trace?a("l-polyline",{attrs:{"lat-lngs":t.trace,className:"traceLine"}}):t._e(),t._l(t.routes,(function(e,i){return a("l-route-layer-group",{key:i,attrs:{value:e,active:!1},on:{"contextmenu-waypoint":function(a){return t.setDestination(e[a])}}})})),a("l-destination-marker",{attrs:{origin:t.lastKnownLocation},model:{value:t.destination,callback:function(e){t.destination=e},expression:"destination"}})],2)],1)},o=[],n=a("cd48"),s=(a("29ae"),a("6cc5"),a("2699")),l=a("c8b6"),r=a("635f"),c=a("c222"),u=a("f9de"),d=a("08df");const p={data(){return{maxAccuracy:150,minSpeed:1e3/3600,minDistance:1,geoOptions:{watch:!0,enableHighAccuracy:!0,timeout:5e3,maximumAge:1e3}}},mixins:[d["c"]],methods:{stopLocate(){this.map.stopLocate()},startLocate(){this.map.locate(this.geoOptions)},_locationFound(t){let e=u["a"].from(t);try{if(e.accuracy>this.maxAccuracy)throw{type:"locationerror",message:`Geolocation error: too low accuracy (${e.accuracy}m)`}}catch(a){return void this._locationError(a)}if(!(this.lastKnownLocation instanceof u["a"]&&e.distanceTo(this.lastKnownLocation)<=this.minDistance)&&(this.lastKnownLocation instanceof u["a"]&&e.computeMovementFrom(this.lastKnownLocation),e.altitude.accuracy>this.maxAccuracy&&(e.altitude=void 0),e.speed<this.minSpeed&&(e.speed=void 0,e.heading=void 0),this.lastKnownLocation=e,this.settings.setView&&this.bestView(e),this.settings.inFlight)){this.addLocation(e);const t=this.getDestination(e);t&&this.setDestination(t)}},_locationError(t){console.error(t),delete t.sourceTarget,delete t.target,this.lastKnownError={...t},this.openWarning(t.message,"Stop GNSS",()=>this.settings.getLocation=!1)},_fakeLocation({latitude:t=0,longitude:e=0,accuracy:a=20,altitude:i=1e3},o=5){console.debug("faking location");let n=(t=o)=>(Math.random()-.5)*t;return u["a"].from({latitude:t+n(o/100),longitude:e+n(o/100),accuracy:a+n(a*o/100),altitude:i+n(i*o/100),altitudeAccuracy:a+n(a*o/100),timestamp:Date.now()})}}};var m=a("b8bf"),g=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("l-control",t._b({},"l-control",t.$attrs,!1),[a("b-field",[a("b-dropdown",{attrs:{position:"is-top-right"}},[a("p",{staticClass:"control",attrs:{slot:"trigger"},slot:"trigger"},[a("button",{staticClass:"button"},[a("b-tooltip",{attrs:{label:"Settings"}},[a("b-icon",{attrs:{icon:"cog-outline"}})],1)],1)]),a("b-dropdown-item",[a("b-switch",{model:{value:t.value.getLocation,callback:function(e){t.$set(t.value,"getLocation",e)},expression:"value.getLocation"}},[t._v("Use GNSS")])],1),a("b-dropdown-item",[a("b-switch",{attrs:{disabled:!t.value.getLocation},model:{value:t.value.setView,callback:function(e){t.$set(t.value,"setView",e)},expression:"value.setView"}},[t._v("Keep view centered")])],1),a("b-dropdown-item",[a("b-switch",{model:{value:t.value.zoomControl,callback:function(e){t.$set(t.value,"zoomControl",e)},expression:"value.zoomControl"}},[t._v("Display zoom control")])],1),a("b-dropdown-item",[a("b-button",{attrs:{size:"is-small","icon-right":"map-marker-remove-outline",outlined:"",expanded:""},on:{click:function(e){return t.$emit("delete-track")}}},[t._v("Delete trace")])],1)],1),t.value.inFlight?a("p",{staticClass:"control"},[a("button",{staticClass:"button",on:{click:function(e){t.value.inFlight=!1}}},[a("b-tooltip",{attrs:{label:"Stop"}},[a("b-icon",{attrs:{type:"is-danger",icon:"airplane-landing"}})],1)],1)]):[a("p",{staticClass:"control"},[a("button",{staticClass:"button",on:{click:function(e){return t.$emit("open-navigation")}}},[a("b-tooltip",{attrs:{label:"Select a navigation"}},[a("b-icon",{attrs:{icon:"map-marker-path"}})],1)],1)]),a("p",{staticClass:"control"},[a("button",{staticClass:"button",on:{click:function(e){t.value.inFlight=!0}}},[a("b-tooltip",{attrs:{label:"Start"}},[a("b-icon",{attrs:{icon:"airplane-takeoff"}})],1)],1)])]],2)],1)},h=[],v=a("2253"),b={name:"LMovingMapToolboxControl",components:{LControl:v["a"]},props:{value:{type:Object,default:()=>({getLocation:!0,setView:!0,zoomControl:!1,inFlight:!1})}},computed:{aircraft(){return this.$store.state.currentAircraft},navigation(){return this.$store.state.currentNavigation}},watch:{value:{deep:!0,handler(t){this.$emit("input",t)}}}},f=b,y=a("2877"),L=Object(y["a"])(f,g,h,!1,null,null,null),_=L.exports,w=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("l-control",t._b({},"l-control",t.$attrs,!1),[a("b-field",{attrs:{grouped:"","group-multiline":""}},[a("div",{staticClass:"control"},[a("b-taglist",{attrs:{attached:""}},[a("b-tag",{attrs:{type:"is-primary",size:"is-medium"}},[t._v(t._s(t._f("precision")(t._f("to")(t.value.speed,"kt"),0)))]),a("b-tag",{attrs:{type:"is-light",size:"is-medium"}},[t._v("kt")])],1)],1),a("div",{staticClass:"control"},[a("b-taglist",{attrs:{attached:""}},[a("b-tag",{attrs:{type:"is-primary",size:"is-medium"}},[t._v(t._s(t._f("precision")(t._f("asHeading")(t.value.heading),0)))]),a("b-tag",{attrs:{type:"is-light",size:"is-medium"}},[t._v("°")])],1)],1),a("div",{staticClass:"control"},[a("b-taglist",{attrs:{attached:""}},[a("b-tag",{attrs:{type:"is-info",size:"is-medium"}},[t._v(t._s(t._f("precision")(t._f("to")(t.value.altitude,"ft"),-1)))]),a("b-tag",{attrs:{type:"is-light",size:"is-medium"}},[t._v("ft")])],1)],1),a("div",{staticClass:"control"},[a("b-taglist",{attrs:{attached:""}},[a("b-tag",{attrs:{type:"is-dark",size:"is-medium"}},[t._v(t._s(t._f("precision")(t._f("to")(t.value.vario,"ft/min"),-1)))]),a("b-tag",{attrs:{type:"is-light",size:"is-medium"}},[t._v("ft/min")])],1)],1)])],1)},k=[],C=a("2e0e"),x={name:"LMovingMapInstrumentsControl",components:{LControl:v["a"]},props:{value:{type:Object,default:()=>({speed:null,altitude:null,heading:null,vario:null})}},mixins:[C["a"]]},M=x,D=Object(y["a"])(M,w,k,!1,null,null,null),z=D.exports,$=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("l-control",t._b({},"l-control",t.$attrs,!1),[a("b-field",{attrs:{grouped:"","group-multiline":""}},[a("div",{staticClass:"control"},[a("b-taglist",{attrs:{attached:""}},[a("b-tag",{attrs:{type:"is-success",size:"is-medium"}},[t._v(t._s(t._f("precision")(t._f("to")(t.distance,"NM"),0)))]),a("b-tag",{attrs:{type:"is-light",size:"is-medium"}},[t._v("NM")])],1)],1),a("div",{staticClass:"control"},[a("b-taglist",{attrs:{attached:""}},[a("b-tag",{attrs:{type:"is-info",size:"is-medium"}},[t._v(t._s(t._f("precision")(t._f("asHeading")(t.heading),0)))]),a("b-tag",{attrs:{type:"is-light",size:"is-medium"}},[t._v("°")])],1)],1),a("div",{staticClass:"control"},[a("b-taglist",{attrs:{attached:""}},[a("b-tag",{attrs:{type:"is-light",size:"is-medium"}},[t._v("ETE")]),a("b-tag",{attrs:{type:"is-primary",size:"is-medium"}},[t._v(t._s(t._f("asDuration")(t.ETE)))])],1)],1)])],1)},S=[],K={name:"LMovingMapDestinationControl",components:{LControl:v["a"]},props:{from:Object,to:Object},mixins:[C["a"]],computed:{distance(){return this.from.distanceTo(this.to)},ETE(){return this.distance/this.from.speed},heading(){return this.from.bearingTo(this.to)},relative_bearing(){return this.heading-this.from.heading},vertical_speed(){return(this.to.altitude-this.from.altitude)/this.ETE}}},E=K,N=Object(y["a"])(E,$,S,!1,null,null,null),T=N.exports,O=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("l-layer-group",[t.value.latlng?a("l-marker",{attrs:{"lat-lng":t.value.latlng}},[a("l-icon",{attrs:{"class-name":"leaflet-diamond-icon"}},[a("div")])],1):t._e(),t.value.latlng&&t.value.accuracy?a("l-circle",{attrs:{"lat-lng":t.value.latlng,radius:t.value.accuracy,className:"accuracyCircle"}}):t._e(),this.value.latlng&&this.value.heading&&this.value.speed?a("l-polyline",{attrs:{"lat-lngs":t.speedVector,className:"speedVector"}}):t._e()],1)},V=[],j=a("1ebb"),A=a("4e2b"),F=a("fbba"),B=a("0dbd"),G={name:"LLocationMarker",components:{LLayerGroup:j["a"],LMarker:A["a"],LIcon:F["a"],LPolyline:r["a"],LCircle:B["a"]},props:{value:{type:Object,default:()=>({latlng:null,speed:null,heading:null,accuracy:null})},delay:{type:Number,default:()=>60}},computed:{speedVector(){return[this.value.latlng,this.value.destinationPoint(this.value.speed*this.delay,this.value.heading)]}}},P=G,I=(a("0223"),Object(y["a"])(P,O,V,!1,null,null,null)),H=I.exports,J=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.origin&&t.value?a("span",[a("l-layer-group",[a("l-marker",{attrs:{"lat-lng":t.value.latlng},on:{contextmenu:function(e){return t.$emit("input")}}},[a("l-icon",{attrs:{"class-name":"leaflet-destination-icon"}},[a("div")])],1),a("l-polyline",{attrs:{"lat-lngs":t.destinationVector,className:"destinationVector"}})],1)],1):t._e()},W=[],R=a("ef62"),U={name:"LDestinationMarker",components:{LLayerGroup:j["a"],LMarker:A["a"],LIcon:F["a"],LPolyline:r["a"]},props:["value","origin"],mounted(){this.map=Object(R["d"])(this.$parent,!0).mapObject},computed:{destinationVector(){return[this.origin.latlng,this.value.latlng]}}},Z=U,q=(a("1849"),Object(y["a"])(Z,J,W,!1,null,null,null)),Q=q.exports,X=a("4b61"),Y={name:"MovingMap",components:{NavigationSelect:n["a"],LMap:s["a"],LControlZoom:l["a"],LControlFullscreen:c["a"],LPolyline:r["a"],LBaseLayerGroup:m["a"],LMovingMapToolboxControl:_,LMovingMapInstrumentsControl:z,LMovingMapDestinationControl:T,LLocationMarker:H,LRouteLayerGroup:X["a"],LDestinationMarker:Q},mixins:[d["d"],p],data(){return{lastKnownLocation:void 0,lastKnownError:void 0,destination:void 0,traceDB:"navue_trace",traceType:"location",futurPositionDelay:180,minDestination:100,traceLength:200,settings:{getLocation:!0,setView:!0,zoomControl:!1,inFlight:!1},navigation:void 0,isNavigationSelectActive:!1}},beforeDestroy(){this.stopLocate()},computed:{map(){return this.$refs.movingMap.mapObject},trace(){return(this.reportedLocations||[]).map(t=>[t.latitude,t.longitude])},routes(){return this.navigation?this.navigation.routes:[]}},watch:{"settings.setView":function(t){t&&this.lastKnownLocation&&this.bestView(this.lastKnownLocation)},"settings.getLocation":{handler(t){t?this.startLocate():this.stopLocate()}}},pouch:{reportedLocations(){return{database:this.traceDB,limit:this.traceLength,selector:{type:this.traceType}}}},methods:{setupMap(t){t.on("locationfound",this._locationFound,this).on("locationerror",this._locationError,this),this.settings.getLocation&&this.startLocate()},bestView(t){this.map.flyToBounds(t.toBounds(t.speed?t.speed*this.futurPositionDelay:t.accuracy),{padding:[100,100]})},addLocation(t){return this.$pouch[this.traceDB].post({...t,_id:t.timestamp.toString()},{})},removeLocations(){this.$pouch[this.traceDB].destroy().then(()=>{let t=this.traceType;this.traceType=null,this.traceType=t}).catch(console.error)},setDestination(t){this.destination=new u["b"](t)},getDestination(t){this.destination&&t.distanceTo(this.destination)<this.minDestination&&(this.destination=this.navigation.getNextWaypoint(this.destination))}}},tt=Y,et=(a("30d1"),Object(y["a"])(tt,i,o,!1,null,null,null));e["default"]=et.exports},ae67:function(t,e,a){},b7de:function(t,e,a){}}]);