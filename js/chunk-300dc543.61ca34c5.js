(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-300dc543"],{"1a7b":function(t,e,i){"use strict";var n=i("5878"),a=i.n(n);a.a},"263c":function(t,e,i){"use strict";var n=i("c105"),a=i.n(n);a.a},"30d1":function(t,e,i){"use strict";var n=i("b7de"),a=i.n(n);a.a},3935:function(t,e,i){"use strict";i.r(e);var render=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("section",{staticStyle:{height:"100%"}},[i("l-map",t._b({ref:"movingMap",on:{ready:t.setupMap,contextmenu:t.setDestination}},"l-map",t.settings.map,!1),[i("l-control",{attrs:{position:"topleft"}},[i("b-field",[i("MovingMapSettings",t._b({attrs:{position:"is-bottom-right",triggers:["click","hover"]},on:{"update:settings":t.updateSettings}},"MovingMapSettings",t.settings,!1)),i("DataToolbar",{attrs:{navigation:"",aircraft:"",flight:"",traceDB:t.traceDB,dropdown:{position:"is-bottom-right",triggers:["click","hover"]}}})],1)],1),t.settings.zoomControl?i("l-control-zoom",{attrs:{position:"topleft"}}):t._e(),i("l-control",{attrs:{position:"bottomleft"}},[i("ReportToolbar",{attrs:{tooltip:{position:"is-top"}}})],1),i("l-control",{attrs:{position:"bottomleft"}},[t.lastKnownLocation&&t.destination?i("DestinationDisplay",{attrs:{from:t.lastKnownLocation,to:t.destination}}):t._e()],1),i("l-control",{attrs:{position:"topright"}},[i("InstrumentsDisplay")],1),i("l-control",{attrs:{position:"bottomright"}},[i("TimerToolbar",{on:{"update:settings":t.updateSettings}})],1),i("l-base-layer-group"),i("l-location-marker",{attrs:{"v-if":t.lastKnownLocation,value:t.lastKnownLocation,delay:t.settings.futurPositionDelay}}),t.trace?i("l-polyline",{attrs:{"lat-lngs":t.trace,className:"traceLine"}}):t._e(),t._l(t.routes,(function(e,n){return i("l-route-layer-group",{key:n,attrs:{value:e.items,active:!1},on:{"contextmenu-waypoint":function(i){return t.setDestination(e.items[i])}}})})),i("l-destination-marker",{attrs:{origin:t.lastKnownLocation},model:{value:t.destination,callback:function(e){t.destination=e},expression:"destination"}})],2)],1)},n=[],a=(i("29ae"),i("6cc5"),i("2699")),o=i("c8b6"),s=i("2253"),r=i("635f"),l=i("f9de"),c=i("08df");const u={data(){return{geoOptions:{enableHighAccuracy:!0,timeout:5e3,maximumAge:1e3},settings:{maxAccuracy:150,minSpeed:.2,minDistance:1}}},mixins:[c["c"]],methods:{stopLocate(){this.lastKnownLocation=void 0,navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId)},startLocate(){if(!("geolocation"in navigator))return this._locationError({code:0,message:"Geolocation not supported."}),this;this._locationWatchId=navigator.geolocation.watchPosition(this._locationFound,this._locationError,this.geoOptions)},_locationFound(t){let e=l["a"].fromGeolocationPosition(t);try{if(e.accuracy>this.settings.maxAccuracy)throw{...e,type:"locationerror",message:`Geolocation error: too low accuracy (${e.accuracy}m)`}}catch(i){return void this._locationError(i)}if(!(this.lastKnownLocation instanceof l["a"]&&e.distanceTo(this.lastKnownLocation)<=this.settings.minDistance)&&(e.altitude&&e.altitude.accuracy>this.settings.maxAccuracy&&(e.altitude=void 0),e.speed<this.settings.minSpeed&&(e.speed=void 0,e.heading=void 0),this.lastKnownLocation=e,this.settings.setView&&this.bestView(e),this.settings.inFlight)){this.addLocation(e);const t=this.getDestination(e);t&&this.setDestination(t)}},_locationError({message:t}){this.openWarning(t,"Stop GNSS",()=>this.settings.getLocation=!1)},_fakeLocation({latitude:t=0,longitude:e=0,accuracy:i=20,altitude:n=1e3,speed:a=50,heading:o=0}){console.debug("Faking around");let rand=(t=1)=>(Math.random()-.5)*t;return{latitude:t+rand(.3),longitude:e+rand(.3),accuracy:i+rand(),altitude:n+rand(100),altitudeAccuracy:i+rand(),heading:o+rand(10),speed:a+rand(),timestamp:Date.now()}}}};var MovingMapSettingsvue_type_template_id_338b15ce_render=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("b-dropdown",t._b({},"b-dropdown",t.$attrs,!1),[i("b-button",{attrs:{slot:"trigger"},slot:"trigger"},[i("b-icon",{attrs:{icon:"cog-outline"}})],1),i("b-dropdown-item",{attrs:{custom:""}},[i("b-switch",{attrs:{value:t.getLocation},on:{input:function(e){return t.$emit("update:settings",{getLocation:e})}}},[t._v("Use GNSS")])],1),i("b-dropdown-item",{attrs:{custom:""}},[i("b-switch",{attrs:{value:t.setView,disabled:!t.getLocation},on:{input:function(e){return t.$emit("update:settings",{setView:e})}}},[t._v("Keep view centered")])],1),i("b-dropdown-item",{attrs:{custom:""}},[i("b-switch",{attrs:{value:t.fullScreen},on:{input:function(e){return t.$emit("update:settings",{fullScreen:e})}}},[t._v("Set Map Fullscreen")])],1),i("b-dropdown-item",{attrs:{custom:""}},[i("b-switch",{attrs:{value:t.zoomControl},on:{input:function(e){return t.$emit("update:settings",{zoomControl:e})}}},[t._v("Display zoom control")])],1),i("b-dropdown-item",{attrs:{separator:""}}),i("b-dropdown-item",{attrs:{custom:""}},[i("b-field",{attrs:{label:"Trace length"}},[i("b-numberinput",{attrs:{size:"is-small","controls-position":"compact",editable:!1,step:"50",min:"10",value:t.traceLength},on:{input:function(e){return t.$emit("update:settings",{traceLength:e})}}})],1)],1),i("b-dropdown-item",{attrs:{custom:""}},[i("b-field",{attrs:{label:"Futur postition delay (min.)"}},[i("b-numberinput",{attrs:{size:"is-small","controls-position":"compact",editable:!1,step:"1",min:"0",value:t.futurPositionDelay},on:{input:function(e){return t.$emit("update:settings",{futurPositionDelay:e})}}})],1)],1),i("b-dropdown-item",{attrs:{custom:""}},[i("b-field",{attrs:{label:"Max. accuracy allowed"}},[i("b-numberinput",{attrs:{size:"is-small","controls-position":"compact",editable:!1,step:"10",min:"1",value:t.maxAccuracy},on:{input:function(e){return t.$emit("update:settings",{maxAccuracy:e})}}})],1)],1),i("b-dropdown-item",{attrs:{custom:""}},[i("b-field",{attrs:{label:"Min. spd allowed"}},[i("b-numberinput",{attrs:{size:"is-small","controls-position":"compact",editable:!1,step:".05",min:"0",value:t.minSpeed},on:{input:function(e){return t.$emit("update:settings",{minSpeed:e})}}})],1)],1),i("b-dropdown-item",{attrs:{custom:""}},[i("b-field",{attrs:{label:"Min. dist. allowed"}},[i("b-numberinput",{attrs:{size:"is-small","controls-position":"compact",editable:!1,step:"1",min:"0",value:t.minDistance},on:{input:function(e){return t.$emit("update:settings",{minDistance:e})}}})],1)],1),i("b-dropdown-item",{attrs:{custom:""}},[i("b-field",{attrs:{label:"Min. destination dist."}},[i("b-numberinput",{attrs:{size:"is-small","controls-position":"compact",editable:!1,step:"10",min:"1",value:t.minDestination},on:{input:function(e){return t.$emit("update:settings",{minDestination:e})}}})],1)],1)],1)},d=[],m={name:"LMovingMapSettingsControl",props:{getLocation:Boolean,setView:Boolean,fullScreen:Boolean,zoomControl:Boolean,traceLength:Number,futurPositionDelay:Number,maxAccuracy:Number,minSpeed:Number,minDistance:Number,minDestination:Number,inFlight:Boolean}},p=m,h=i("2877"),g=Object(h["a"])(p,MovingMapSettingsvue_type_template_id_338b15ce_render,d,!1,null,null,null),f=g.exports,InstrumentsDisplayvue_type_template_id_4b3dbc5a_render=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.location?i("b-taglist",[i("b-tag",{attrs:{type:"is-primary",size:"is-medium"}},[t._v(t._s(t._f("as")(t.location.speed,"kt",2)))]),i("b-tag",{attrs:{type:"is-success",size:"is-medium"}},[t._v(t._s(t._f("as")(t.location.heading,"Â°",2)))]),i("b-tag",{attrs:{type:"is-info",size:"is-medium"}},[t._v(t._s(t._f("as")(t.location.altitude,"ft",2)))]),i("b-tag",{attrs:{type:"is-dark",size:"is-medium"}},[t._v("-")])],1):t._e()},b=[],v=i("2e0e"),y={name:"InstrumentsDisplay",mixins:[v["a"]],computed:{location(){return this.$store.state.currentLocation}}},_=y,L=Object(h["a"])(_,InstrumentsDisplayvue_type_template_id_4b3dbc5a_render,b,!1,null,null,null),w=L.exports,DestinationDisplayvue_type_template_id_105a1df0_render=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("b-taglist",[i("b-tag",{attrs:{type:"is-primary",size:"is-medium"}},[t._v(t._s(t._f("as")(t.distance,"NM")))]),i("b-tag",{attrs:{type:"is-success",size:"is-medium"}},[t._v(t._s(t.heading))]),i("b-tag",{attrs:{type:"is-info",size:"is-medium"}},[t._v(t._s(t._f("as")(t.to.altitude,"ft")))]),i("b-tag",{attrs:{type:"is-light",size:"is-medium"}},[t._v(t._s(t._f("as")(t.vertical_speed,"m/s")))]),i("b-tag",{attrs:{type:"is-dark",size:"is-medium"}},[t._v("ETE "+t._s(t._f("asDuration")(t.ETE)))])],1)},D=[],T=i("3634"),x={name:"DestinationDisplay",props:{from:Object,to:Object},mixins:[v["a"]],computed:{distance(){return this.from.distanceTo(this.to)},ETE(){return this.distance/this.from.speed},heading(){return this.from.bearingTo(this.to)},vertical_speed(){return new T["e"]((this.to.altitude-this.from.altitude)/this.ETE,"m/s")}}},k=x,M=Object(h["a"])(k,DestinationDisplayvue_type_template_id_105a1df0_render,D,!1,null,null,null),$=M.exports,TimerToolbarvue_type_template_id_940c2e8a_scoped_true_render=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.flight?i("nav",{staticClass:"level is-mobile box"},[i("div",{staticClass:"level-item has-text-centered"},[i("div",[i("p",{staticClass:"heading"},[i("b-icon",{attrs:{type:t.isEnroute?"is-danger":"is-primary",icon:t.isEnroute?"airplane-landing":"airplane-takeoff"}})],1),i("p",{staticClass:"title is-clickable",on:{click:function(e){!t.isEnroute&&t.startFlight()},contextmenu:function(e){e.preventDefault(),e.stopPropagation(),t.isEnroute&&t.stopFlight()}}},[t._v(" "+t._s(t._f("asDuration")(t.flightDuration))+" ")])])]),i("div",{staticClass:"level-item has-text-centered"},[i("div",[i("p",{staticClass:"heading"},[i("b-icon",{attrs:{icon:"timer-outline",type:t.chronoTime?"is-danger":"is-primary"}})],1),i("p",{staticClass:"title is-clickable",on:{click:t.startChrono,contextmenu:function(e){return e.preventDefault(),e.stopPropagation(),t.stopChrono(e)}}},[t._v(" "+t._s(t._f("asDuration")(t.chrono))+" ")])])]),i("div",{staticClass:"level-item has-text-centered"},[i("div",[i("p",{staticClass:"heading"},[i("b-icon",{attrs:{icon:"alarm-plus"}})],1),i("div",{staticClass:"is-clickable timelist",on:{click:function(e){return e.stopPropagation(),t.addTime(e)},contextmenu:function(e){return e.preventDefault(),e.stopPropagation(),t.removeTime(e)}}},[i("ul",t._l(t.flight.markedTimes,(function(e,n){return i("li",{key:n},[t._v(" "+t._s(t._f("asDuration")(e))+" ")])})),0),i("span",{staticClass:"title"},[t._v(" - ")])])])])]):t._e()},S=[],C={name:"TimerToolbar",mixins:[v["a"]],data(){return{currentTime:void 0,currentUpdater:void 0,chronoTime:void 0,finishedAt:null,startedAt:null}},mounted(){this.currentUpdater=setInterval(()=>{this.currentTime=new Date},1e3)},destroyed(){clearInterval(this.currentUpdater)},computed:{isEnroute(){return!!this.startedAt&&!this.finishedAt},flightDuration(){return this.finishedAt?this.finishedAt-this.startedAt:this.startedAt?Math.max(0,this.currentTime-this.startedAt):null},chrono(){return this.chronoTime?Math.max(0,this.currentTime-this.chronoTime):null},timesCount(){return this.markedTimes.length},flight(){return this.$store.state.currentFlight}},methods:{startFlight(){this.finishedAt=void 0,this.startedAt=new Date,this.$emit("update:settings",{inFlight:this.isEnroute})},stopFlight(){this.finishedAt=new Date,this.$emit("update:settings",{inFlight:this.isEnroute})},startChrono(){this.chronoTime=new Date},stopChrono(){this.chronoTime=void 0},addTime(){this.flight.markedTimes.unshift(new Date)},removeTime(){this.flight.markedTimes.shift()}}},E=C,z=(i("1a7b"),Object(h["a"])(E,TimerToolbarvue_type_template_id_940c2e8a_scoped_true_render,S,!1,null,"940c2e8a",null)),F=z.exports,A=i("0592"),N=i("8f42"),P=i("a75e"),LLocationMarkervue_type_template_id_041e246e_render=function(){var t=this,e=t.$createElement,i=t._self._c||e;return this.value&&this.value.latlng?i("l-layer-group",[i("l-marker",{attrs:{"lat-lng":t.value.latlng}},[i("l-icon",{attrs:{"class-name":"leaflet-diamond-icon"}},[i("div")])],1),t.value.accuracy?i("l-circle",{attrs:{"lat-lng":t.value.latlng,radius:t.value.accuracy.value,className:"accuracyCircle"}}):t._e(),t.value.heading&&t.value.speed?[i("l-polyline",{attrs:{"lat-lngs":t.speedVector,className:"speedVector"}}),t._l(t.delay,(function(e){return i("l-marker",{key:e,attrs:{"lat-lng":t.nMinutesPosition(e)}},[i("l-icon",{attrs:{"class-name":"leaflet-number-icon",iconSize:["1em","1em"]}},[i("div",[t._v(t._s(e))])])],1)}))]:t._e()],2):t._e()},O=[],B=i("1ebb"),V=i("4e2b"),j=i("fbba"),K=i("0dbd"),I={name:"LLocationMarker",components:{LLayerGroup:B["a"],LMarker:V["a"],LIcon:j["a"],LPolyline:r["a"],LCircle:K["a"]},props:{value:{type:Object,default:()=>({latlng:null,speed:null,heading:null,accuracy:null})},delay:{type:Number,default:()=>3}},computed:{speedVector(){return[this.value.latlng,this.nMinutesPosition(this.delay)]}},methods:{nMinutesPosition(t){return this.value.positionInSeconds(60*t).latlng}}},G=I,W=(i("3e8f"),Object(h["a"])(G,LLocationMarkervue_type_template_id_041e246e_render,O,!1,null,null,null)),J=W.exports,LDestinationMarkervue_type_template_id_a51151aa_render=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.origin&&t.value?i("span",[i("l-layer-group",[i("l-marker",{attrs:{"lat-lng":t.value.latlng},on:{contextmenu:function(e){return t.$emit("input")}}},[i("l-icon",{attrs:{"class-name":"leaflet-destination-icon"}},[i("div")])],1),i("l-polyline",{attrs:{"lat-lngs":t.destinationVector,className:"destinationVector"}},[i("l-tooltip",{attrs:{options:{className:"routeLabel",direction:"center",permanent:!0}}},[t._v(" "+t._s(t.heading)+" | "+t._s(t._f("as")(t.distance,"NM",3))+" ")])],1)],1)],1):t._e()},U=[],R=i("31dc"),q=i("ef62"),H={name:"LDestinationMarker",mixins:[v["a"]],components:{LLayerGroup:B["a"],LMarker:V["a"],LIcon:j["a"],LPolyline:r["a"],LTooltip:R["a"]},props:["value","origin"],mounted(){this.map=Object(q["d"])(this.$parent,!0).mapObject},computed:{destinationVector(){return[this.origin.latlng,this.value.latlng]},distance(){return this.origin.distanceTo(this.value)},heading(){return this.origin.bearingTo(this.value)}}},Z=H,Q=(i("263c"),Object(h["a"])(Z,LDestinationMarkervue_type_template_id_a51151aa_render,U,!1,null,null,null)),X=Q.exports,Y=i("2cec"),tt={name:"MovingMap",components:{LMap:a["a"],LControlZoom:o["a"],LControl:s["a"],LPolyline:r["a"],MovingMapSettings:f,InstrumentsDisplay:w,DestinationDisplay:$,TimerToolbar:F,ReportToolbar:A["a"],DataToolbar:N["a"],LBaseLayerGroup:P["a"],LLocationMarker:J,LRouteLayerGroup:Y["a"],LDestinationMarker:X},mixins:[c["d"],u],data(){return{destination:void 0,traceDB:"navue_trace",traceType:"Location",settings:{getLocation:!0,setView:!0,fullScreen:!!document.fullscreenElement,zoomControl:!1,inFlight:!1,traceLength:250,minDestination:100,futurPositionDelay:3,map:{zoom:10,center:{lat:42.69597591582309,lng:2.879308462142945},options:{zoomSnap:.5,zoomControl:!1,attributionControl:!1}}}}},beforeDestroy(){this.stopLocate()},computed:{map(){return this.$refs.movingMap.mapObject},trace(){return(this.reportedLocations||[]).map(t=>[t.latitude,t.longitude])},navigation(){return this.$store.state.currentNavigation},routes(){return this.navigation?this.navigation.routes:[]},lastKnownLocation:{get(){return this.$store.state.currentLocation},set(t){this.$store.commit("currentLocation",t)}},flight:{get(){return this.$store.state.currentFlight},set(t){this.$store.commit("currentFlight",t)}}},watch:{"settings.setView":function(t){t&&this.lastKnownLocation&&this.bestView(this.lastKnownLocation)},"settings.fullScreen":function(t){this.toggleFullscreen(this.map.getContainer(),t)},"settings.getLocation":function(t){t?this.startLocate():this.stopLocate()},"settings.inFlight":function(t){this.settings.fullScreen=t},navigation(t){try{let e=t.toBounds();this.map.flyToBounds(e,{padding:[50,50]})}catch{}}},pouch:{reportedLocations(){return{database:this.traceDB,limit:this.settings.traceLength,selector:{type:this.traceType},sort:[{timestamp:"desc"}]}}},methods:{setupMap(t){t.on("locationfound",this._locationFound,this).on("locationerror",this._locationError,this),this.settings.getLocation&&this.startLocate()},bestView(t){let e=t.toBounds(t.speed?t.speed*this.settings.futurPositionDelay*60:t.accuracy);this.map.flyToBounds(e,{padding:[100,100]})},addLocation(t){let e=JSON.parse(JSON.stringify(t));return e._id=t.timestamp.toString(),this.$pouch[this.traceDB].put(e,{})},setDestination({latlng:t,latitude:e,longitude:i,altitude:n}={}){this.destination=l["b"].from({latlng:t,latitude:e,longitude:i,altitude:n,type:"Waypoint"})},getDestination(t){this.destination&&t.distanceTo(this.destination)<this.settings.minDestination&&(this.destination=this.navigation.getNextWaypoint(this.destination))},updateSettings(t){this.settings={...this.settings,...t}},toggleFullscreen(t,e){void 0==e?document.fullscreenElement?document.exitFullscreen():t.requestFullscreen():e?t.requestFullscreen():document.exitFullscreen()}}},et=tt,it=(i("30d1"),Object(h["a"])(et,render,n,!1,null,null,null));e["default"]=it.exports},"3e8f":function(t,e,i){"use strict";var n=i("847f"),a=i.n(n);a.a},5878:function(t,e,i){},"847f":function(t,e,i){},b7de:function(t,e,i){},c105:function(t,e,i){}}]);