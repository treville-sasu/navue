(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a7b1e534"],{"123f":function(t,e,i){"use strict";i("2da0")},"263c":function(t,e,i){"use strict";i("c105")},"2da0":function(t,e,i){},"3e8f":function(t,e,i){"use strict";i("847f")},"68ff":function(t,e,i){},"847f":function(t,e,i){},c105:function(t,e,i){},da77:function(t,e,i){"use strict";i("68ff")},ef23:function(t,e,i){"use strict";i.r(e);var render=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("section",{staticStyle:{height:"100%"}},[i("l-map",t._b({ref:"movingMap",on:{ready:t.setupMap,contextmenu:t.setDestination}},"l-map",t.settings.map,!1),[i("l-control",{attrs:{position:"topleft"}},[i("b-field",{staticClass:"is-stackable"},[i("MovingMapSettings",t._b({attrs:{position:"is-bottom-right",triggers:["click","hover"]},on:{"update:settings":t.updateSettings}},"MovingMapSettings",t.settings,!1)),t.settings.inFlight?t._e():i("DataToolbox",{attrs:{location:"",navigation:"",aircraft:"",flight:{create:!0,trace:t.traceDB},dropdown:{position:"is-bottom-right",triggers:["click","hover"]}}})],1)],1),t.settings.zoomControl?i("l-control-zoom",{attrs:{position:"topleft"}}):t._e(),i("l-control",{attrs:{position:"bottomleft"}},[i("ReportToolbox",{staticClass:"is-stackable",attrs:{tooltip:{position:"is-top"},navlog:"",checklists:"",vac:"",weather:"",aip:"",notepad:""}})],1),i("l-control",{attrs:{position:"topright"}},[t.currentLocation?i("InstrumentsDisplay",t._b({staticClass:"is-stackable"},"InstrumentsDisplay",t.currentLocation.properties,!1)):t._e()],1),i("l-control",{attrs:{position:"bottomright"}},[i("TimerToolbox",{on:{"update:settings":t.updateSettings}})],1),i("l-base-layer-group"),t.currentLocation?i("l-location-marker",{attrs:{value:t.currentLocation,delay:t.settings.futurPositionDelay},on:t._d({},[t.settings.setView&&"update:bounds",t.bestView])}):t._e(),i("l-polyline",{attrs:{"lat-lngs":t.trace,className:"traceLine"}}),t._l(t.routes,(function(e,n){return i("l-route-layer-group",{key:n,attrs:{value:e,active:!1},on:{"contextmenu-waypoint":function(i){return t.setDestination(e.features[i])}}})})),i("l-destination-marker",{attrs:{to:t.currentDestination,from:t.currentLocation},on:{update:function(e){t.currentDestination=e}}})],2)],1)},n=[],o=(i("29ae"),i("6cc5"),i("2699")),a=i("c8b6"),s=i("2253"),r=i("635f"),l=i("062a"),c=i("3634"),u=i("08df"),p=i("d30b");function randomPosition(t){return Array.isArray(t)?coordInBBox(t):t&&t.bbox?coordInBBox(t.bbox):[lon(),lat()]}function rnd(){return Math.random()-.5}function lon(){return 360*rnd()}function lat(){return 180*rnd()}function coordInBBox(t){return[Math.random()*(t[2]-t[0])+t[0],Math.random()*(t[3]-t[1])+t[1]]}var d=i("62d7"),h=i.n(d),m={mixins:[u["c"]],data(){return{lastError:void 0,geoOptions:{enableHighAccuracy:!0,timeout:5e3,maximumAge:1e3},settings:{maxAccuracy:150,minSpeed:.2,minDistance:1},style:{location:{type:"symbol",filter:["all",["==",["geometry-type"],"Point"],["has","timestamp"]],layout:{"icon-anchor":"center","icon-image":"za-provincial-2","text-field":["get","label"],"text-offset":[0,1.25],"text-anchor":"center"}},futurs:{type:"symbol",filter:["all",["==",["geometry-type"],"Point"],["!",["has","timestamp"]]],layout:{"icon-anchor":"center","text-anchor":"center","text-justify":"center","icon-image":"circle-white-2","text-field":["get","label"]}},course:{type:"line",filter:["==",["geometry-type"],"LineString"],layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":h.a["warning"],"line-width":6,"line-opacity":.7}}}}},beforeDestroy(){this.stopLocate()},computed:{flightCourse(){if(this.currentLocation){let t=[];t.push(this.currentLocation);for(let e=1;e<=this.settings.futurPositionDelay;e++)try{t.push(this.currentLocation.willBeIn(2**e*60,{label:2**e}))}catch{}return t.length>1&&t.push(Object(p["j"])(t.map(t=>t.geometry.coordinates))),Object(p["f"])(t)}}},methods:{stopLocate(){this.currentLocation=void 0,navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId)},startLocate(){if(!("geolocation"in navigator))return this._locationError({code:0,message:"Geolocation not supported by your device."}),this;this._locationWatchId=navigator.geolocation.watchPosition(this._locationFound,this._locationError,this.geoOptions)},_locationFound(t){console.time("location");let e=l["a"].fromGeolocationPosition(t);e.properties.accuracy>this.settings.maxAccuracy?this._locationError({location:e,code:99,message:`Geolocation error: too low accuracy (${e.properties.accuracy})`}):this.currentLocation instanceof l["a"]&&e.distanceTo(this.currentLocation)<=this.settings.minDistance||(e.properties.altitude&&e.properties.altitude.accuracy>this.settings.maxAccuracy&&(e.properties.altitude=void 0),e.properties.speed<this.settings.minSpeed&&(e.properties.speed=void 0,e.properties.heading=void 0),this.lastError=void 0,this.currentLocation=e)},_locationError({message:t,code:e}){switch(e){case 0:case 1:t="You should grant location access in order use these feature. Please change your browser settings";break;case 2:t="Your device can't find your position right now.";break;case 3:t="Last known position too old.";break}this.settings.inFlight&&this.lastError==e&&this.newLeg(),this.lastError=e,this.openWarning({message:t,actionText:"Stop GNSS",onAction:()=>this.settings.getLocation=!1})},_fakeLocation(t,e){return console.debug("Faking around"),t.properties={timestamp:Date.now(),...t.properties,...e},t.geometry.coordinates=randomPosition(t.bbox),this.currentLocation&&(t.properties={...t.properties,...t.legFrom(this.currentLocation)}),t.properties.altitude&&(t.altitude=t.properties.altitude),t}}},g={data(){return{traceDB:"navue_trace",traceType:"Location",trace:[],settings:{traceLength:250}}},async created(){this.setTrace(this.$pouch.getDB(this.traceDB))},beforeDestroy(){this.traceFeed.cancel()},methods:{async setTrace(t){this.trace=await this.getTrace(t),this.traceFeed=t.on("destroyed",e=>{e&&(this.traceFeed.cancel(),this.traceFeed=this.setTrace(this.$pouch.getDB(t.name)))}).changes({since:"now",live:!0,include_docs:!0}).on("change",({doc:{geometry:{coordinates:t}}})=>{this.trace[0]&&t?this.trace[0].unshift([t[1],t[0],t[2]]):this.trace.unshift([])})},getTrace(t){return t.query({map:({_id:t,geometry:{coordinates:e}},i)=>{e&&i(t.split("-")[0],[e[1],e[0],e[2]])},reduce:(t,e)=>e},{group:!0,limit:this.traceLength}).then(({rows:t})=>t.reduce((t,e)=>(t.unshift(e.value),t),[]))}}},f=i("f9de"),b={data(){return{currentDestination:void 0,settings:{minDestination:100,futurPositionDelay:3},style:{destination:{type:"symbol",filter:["==",["geometry-type"],"Point"],layout:{"icon-anchor":"center","text-anchor":"center","text-justify":"center","icon-image":"br-state-2","text-field":["get","label"]}},path:{type:"line",filter:["==",["geometry-type"],"LineString"],layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":h.a["success"],"line-width":6,"line-opacity":.7}},parameters:{type:"symbol",layout:{"symbol-placement":"line","text-allow-overlap":!0,"text-pitch-alignment":"viewport","text-field":["get","label"],"text-size":24},paint:{"text-color":"#FFFFFF","text-halo-color":"#000000","text-halo-width":1.25}}}}},computed:{flightVector(){let t,e=[];return this.currentDestination&&e.push(this.currentDestination),this.currentDestination&&this.currentLocation&&(t=this.currentLocation.greatCircleTo(this.currentDestination),t.properties.label=`${t.properties.bearing} - ${t.properties.distance}`,e.push(t)),Object(p["f"])(e)}},methods:{setDestination({lngLat:t}={}){arguments[0]instanceof f["a"]?this.currentDestination=arguments[0]:this.currentDestination=f["a"].fromEvent({lngLat:t})},getDestination(t){this.destination&&t.distanceTo(this.destination)<this.settings.minDestination&&(this.currentDestination=this.navigation.getNextWaypoint(this.currentDestination))}}},MovingMapSettingsvue_type_template_id_490f6bb4_render=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("b-dropdown",t._b({},"b-dropdown",t.$attrs,!1),[i("b-button",{attrs:{slot:"trigger"},slot:"trigger"},[i("b-icon",{attrs:{icon:"cog-outline"}})],1),i("b-dropdown-item",{attrs:{custom:""}},[i("b-switch",{attrs:{value:t.getLocation},on:{input:function(e){return t.$emit("update:settings",{getLocation:e})}}},[t._v("Use GNSS")])],1),i("b-dropdown-item",{attrs:{custom:""}},[i("b-switch",{attrs:{value:t.setView,disabled:!t.getLocation},on:{input:function(e){return t.$emit("update:settings",{setView:e})}}},[t._v("Keep view centered")])],1),i("b-dropdown-item",{attrs:{custom:""}},[i("b-switch",{attrs:{value:t.fullScreen},on:{input:function(e){return t.$emit("update:settings",{fullScreen:e})}}},[t._v("Set Map Fullscreen")])],1),i("b-dropdown-item",{attrs:{custom:""}},[i("b-switch",{attrs:{value:t.zoomControl},on:{input:function(e){return t.$emit("update:settings",{zoomControl:e})}}},[t._v("Display zoom control")])],1),i("b-dropdown-item",{attrs:{separator:""}}),i("b-dropdown-item",{attrs:{custom:""}},[i("b-field",{attrs:{label:"Trace length"}},[i("b-numberinput",{attrs:{size:"is-small","controls-position":"compact",editable:!1,step:"50",min:"10",value:t.traceLength},on:{input:function(e){return t.$emit("update:settings",{traceLength:e})}}})],1)],1),i("b-dropdown-item",{attrs:{custom:""}},[i("b-field",{attrs:{label:"Futur postition delay (min.)"}},[i("b-numberinput",{attrs:{size:"is-small","controls-position":"compact",editable:!1,step:"1",min:"0",value:t.futurPositionDelay},on:{input:function(e){return t.$emit("update:settings",{futurPositionDelay:e})}}})],1)],1),i("b-dropdown-item",{attrs:{custom:""}},[i("b-field",{attrs:{label:"Max. accuracy allowed"}},[i("b-numberinput",{attrs:{size:"is-small","controls-position":"compact",editable:!1,step:"10",min:"1",value:t.maxAccuracy},on:{input:function(e){return t.$emit("update:settings",{maxAccuracy:e})}}})],1)],1),i("b-dropdown-item",{attrs:{custom:""}},[i("b-field",{attrs:{label:"Min. spd allowed"}},[i("b-numberinput",{attrs:{size:"is-small","controls-position":"compact",editable:!1,step:".05",min:"0",value:t.minSpeed},on:{input:function(e){return t.$emit("update:settings",{minSpeed:e})}}})],1)],1),i("b-dropdown-item",{attrs:{custom:""}},[i("b-field",{attrs:{label:"Min. dist. allowed"}},[i("b-numberinput",{attrs:{size:"is-small","controls-position":"compact",editable:!1,step:"1",min:"0",value:t.minDistance},on:{input:function(e){return t.$emit("update:settings",{minDistance:e})}}})],1)],1),i("b-dropdown-item",{attrs:{custom:""}},[i("b-field",{attrs:{label:"Min. destination dist."}},[i("b-numberinput",{attrs:{size:"is-small","controls-position":"compact",editable:!1,step:"10",min:"1",value:t.minDestination},on:{input:function(e){return t.$emit("update:settings",{minDestination:e})}}})],1)],1)],1)},v=[],y={name:"MovingMapSettingsControl",props:{getLocation:Boolean,setView:Boolean,fullScreen:Boolean,zoomControl:Boolean,traceLength:Number,futurPositionDelay:Number,maxAccuracy:Number,minSpeed:Number,minDistance:Number,minDestination:Number,inFlight:Boolean}},L=y,w=i("2877"),_=Object(w["a"])(L,MovingMapSettingsvue_type_template_id_490f6bb4_render,v,!1,null,null,null),D=_.exports,InstrumentsDisplayvue_type_template_id_08875cc9_render=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("b-taglist",[t.speed?i("b-tag",{attrs:{type:"is-primary",size:"is-medium"}},[t._v(t._s(t._f("as")(t.speed,"kt",3)))]):t._e(),t.heading?i("b-tag",{attrs:{type:"is-success",size:"is-medium"}},[t._v(t._s(t._f("as")(t.heading,"°",3)))]):t._e(),t.altitude?i("b-tag",{attrs:{type:"is-info",size:"is-medium"}},[t._v(t._s(t._f("as")(t.altitude,"ft",3)))]):t._e(),t.linkHealth>=0?i("b-tag",{attrs:{type:"is-dark",size:"is-medium"}},[i("b-icon",{attrs:{icon:"wifi-strength-"+(t.linkHealth>0?t.linkHealth:"alert-outline")}})],1):t._e()],1)},x=[],k=i("2e0e"),T={name:"InstrumentsDisplay",mixins:[k["a"]],props:{speed:c["g"],heading:c["b"],altitude:c["a"]},data(){return{linkStatus:void 0,linkHealth:void 0,goodBandwidth:10,stepsBandwith:4}},mounted(){navigator.connection&&(this.setLink({currentTarget:navigator.connection}),navigator.connection.addEventListener("change",this.setLink))},beforeDestroy(){navigator.connection&&navigator.connection.removeEventListener("change",this.setLink)},methods:{setLink({currentTarget:t}){this.linkHealth=Math.round(Math.min(t.downlink,this.goodBandwidth)/this.goodBandwidth*this.stepsBandwith)}}},M=T,C=Object(w["a"])(M,InstrumentsDisplayvue_type_template_id_08875cc9_render,x,!1,null,null,null),F=C.exports,TimerToolboxvue_type_template_id_12146bee_scoped_true_render=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("nav",{staticClass:"level is-mobile box"},[i("div",{staticClass:"level-item has-text-centered"},[i("div",{staticClass:"is-clickable",on:{click:function(e){!t.isEnroute&&t.startFlight()},contextmenu:function(e){e.preventDefault(),e.stopPropagation(),t.isEnroute&&t.stopFlight()}}},[i("p",{staticClass:"heading"},[i("b-icon",{attrs:{type:t.isEnroute?"is-danger":"is-primary",icon:t.isEnroute?"airplane-landing":"airplane-takeoff"}})],1),i("p",{staticClass:"subtitle"},[t._v(" "+t._s(t._f("asDuration")(t.flightDuration))+" ")])])]),i("div",{staticClass:"level-item has-text-centered"},[i("div",{staticClass:"is-clickable",on:{click:t.startChrono,contextmenu:function(e){return e.preventDefault(),e.stopPropagation(),t.stopChrono.apply(null,arguments)}}},[i("p",{staticClass:"heading"},[i("b-icon",{attrs:{icon:"timer-outline",type:t.chronoTime?"is-danger":"is-primary"}})],1),i("p",{staticClass:"subtitle "},[t._v(" "+t._s(t._f("asDuration")(t.chrono))+" ")])])]),t.flight?i("div",{staticClass:"level-item has-text-centered"},[i("div",{staticClass:"is-clickable",on:{click:function(e){return e.stopPropagation(),t.addTime.apply(null,arguments)},contextmenu:function(e){return e.preventDefault(),e.stopPropagation(),t.removeTime.apply(null,arguments)}}},[i("p",{staticClass:"heading"},[i("b-icon",{attrs:{icon:"alarm-plus"}})],1),i("div",{staticClass:"timelist"},[i("ul",t._l(t.flight.properties.milestones,(function(e,n){return i("li",{key:n},[t._v(" "+t._s(t._f("asDuration")(e))+" ")])})),0),i("span",{staticClass:"subtitle"},[t._v(" - ")])])])]):t._e()])},S=[],$={name:"TimerToolbox",mixins:[k["a"]],data(){return{currentTime:void 0,currentUpdater:void 0,chronoTime:void 0,finishedAt:null,startedAt:null}},mounted(){this.currentUpdater=setInterval(()=>{this.currentTime=new Date},1e3)},destroyed(){clearInterval(this.currentUpdater)},computed:{isEnroute(){return!!this.startedAt&&!this.finishedAt},flightDuration(){return this.finishedAt?this.finishedAt-this.startedAt:this.startedAt?Math.max(0,this.currentTime-this.startedAt):null},chrono(){return this.chronoTime?Math.max(0,this.currentTime-this.chronoTime):null},timesCount(){return this.milestones.length},flight(){return this.$store.state.currentFlight}},methods:{startFlight(){this.finishedAt=void 0,this.startedAt=new Date,this.$emit("update:settings",{inFlight:this.isEnroute})},stopFlight(){this.finishedAt=new Date,this.$emit("update:settings",{inFlight:this.isEnroute})},startChrono(){this.chronoTime=new Date},stopChrono(){this.chronoTime=void 0},addTime(){this.flight.properties.milestones.unshift(new Date)},removeTime(){this.flight.properties.milestones.shift()}}},B=$,E=(i("da77"),Object(w["a"])(B,TimerToolboxvue_type_template_id_12146bee_scoped_true_render,S,!1,null,"12146bee",null)),z=E.exports,A=i("fb37"),P=i("37f7"),I=i("a75e"),LLocationMarkervue_type_template_id_523123bb_render=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.value&&t.value.lngLat?i("l-layer-group",[i("l-marker",{attrs:{"lat-lng":t.value.lngLat}},[i("l-icon",{attrs:{"class-name":"leaflet-diamond-icon"}},[i("div")])],1),t.value.properties.accuracy?i("l-circle",{attrs:{"lat-lng":t.value.lngLat,radius:Number(t.value.properties.accuracy),className:"accuracyCircle"}}):t._e(),t.value.properties.heading&&t.value.properties.speed?[i("l-polyline",{attrs:{"lat-lngs":[t.value.lngLat,t.positionIn(Math.pow(2,t.delay)).lngLat],className:"speedVector"}}),t._l(t.delay,(function(e){return i("l-marker",{key:e,attrs:{"lat-lng":t.positionIn(Math.pow(2,e)).lngLat}},[i("l-icon",{attrs:{"class-name":"leaflet-number-icon",iconSize:["1em","1em"]}},[i("div",[t._v(t._s(Math.pow(2,e)))])])],1)}))]:t._e()],2):t._e()},N=[],j=i("1ebb"),O=i("4e2b"),V=i("fbba"),G=i("0dbd"),H={name:"LLocationMarker",components:{LLayerGroup:j["a"],LMarker:O["a"],LIcon:V["a"],LPolyline:r["a"],LCircle:G["a"]},props:{value:{type:Object,default:()=>({lngLat:null,properties:{speed:null,heading:null,accuracy:null}})},delay:{type:Number,default:()=>3}},methods:{positionIn(t){return this.value.willBeIn(60*t)}},watch:{value:{immediate:!0,handler(){let t=this.value.bounds(this.value.properties.speed?this.value.properties.speed*2**this.delay*60:this.value.properties.accuracy);this.$emit("update:bounds",t)}}}},W=H,J=(i("3e8f"),Object(w["a"])(W,LLocationMarkervue_type_template_id_523123bb_render,N,!1,null,null,null)),U=J.exports,LDestinationMarkervue_type_template_id_66889894_render=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.from&&t.to?i("span",[i("l-layer-group",[i("l-marker",{attrs:{"lat-lng":t.to.lngLat},on:{contextmenu:function(e){return t.$emit("update")}}},[i("l-icon",{attrs:{"class-name":"leaflet-destination-icon"}},[i("div")])],1),i("l-polyline",{attrs:{"lat-lngs":[t.from.lngLat,t.to.lngLat],className:"destinationVector"}})],1)],1):t._e()},q=[],R={name:"LDestinationMarker",components:{LLayerGroup:j["a"],LMarker:O["a"],LIcon:V["a"],LPolyline:r["a"]},props:{from:Object,to:Object},mixins:[k["a"]],computed:{destinationVector(){return[this.from.lngLat,this.to.lngLat]}}},Y=R,K=(i("263c"),Object(w["a"])(Y,LDestinationMarkervue_type_template_id_66889894_render,q,!1,null,null,null)),Z=K.exports,Q=i("2cec"),X={name:"MovingMap",components:{LMap:o["a"],LControlZoom:a["a"],LControl:s["a"],LPolyline:r["a"],MovingMapSettings:D,InstrumentsDisplay:F,TimerToolbox:z,ReportToolbox:A["a"],DataToolbox:P["a"],LBaseLayerGroup:I["a"],LLocationMarker:U,LRouteLayerGroup:Q["a"],LDestinationMarker:Z},mixins:[u["d"],m,g,b],data(){return{legStart:void 0,map:void 0,settings:{getLocation:!0,setView:!0,fullScreen:!!document.fullscreenElement,zoomControl:!1,inFlight:!1,map:{zoom:10,center:{lat:42.69597591582309,lng:2.879308462142945},options:{zoomSnap:.1,zoomControl:!1,attributionControl:!1}}}}},provide:function(){return{getMap:this.getMap}},computed:{navigation(){return this.$store.state.currentNavigation},routes(){return this.navigation?this.navigation.branches:[]},currentLocation:{get(){return this.$store.state.currentLocation},set(t){this.$store.commit("currentLocation",t)}},flight:{get(){return this.$store.state.currentFlight},set(t){this.$store.commit("currentFlight",t)}}},watch:{"settings.fullScreen":function(t){this.toggleFullscreen(this.map.getContainer(),t)},"settings.getLocation":function(t){t?this.startLocate():this.stopLocate()},"settings.inFlight":function(t){t&&(this.newLeg(),this.addLocation(this.currentLocation)),this.settings.fullScreen=t},navigation(t){try{this.map.flyToBounds(t.bbox,{padding:[25,25]})}catch{}},currentLocation(t){if(t&&this.settings.inFlight&&this.addLocation(t),t&&this.navigation){let e=this.getDestination(t);e&&this.setDestination(e)}}},methods:{getMap(){return this.map},newLeg(){this.trace.unshift([]),this.legStart=Date.now()},setupMap(t){this.map=t,this.settings.getLocation&&this.startLocate()},bestView(t){t=[[t[1],t[0]],[t[3],t[2]]],this.map.flyToBounds(t,{padding:[25,25]})},addLocation(t){let e=JSON.parse(JSON.stringify(t));return e._id=`${this.legStart}-${t.properties.timestamp}`,this.$pouch[this.traceDB].put(e)},updateSettings(t){this.settings={...this.settings,...t}},toggleFullscreen(t,e){void 0==e?document.fullscreenElement?document.exitFullscreen():t.requestFullscreen():e?t.requestFullscreen():document.exitFullscreen()}}},tt=X,et=(i("123f"),Object(w["a"])(tt,render,n,!1,null,null,null));e["default"]=et.exports}}]);