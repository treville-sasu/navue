(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-bf374756"],{"0223":function(t,e,a){"use strict";a("ae67")},"0f66":function(t,e,a){},1849:function(t,e,a){"use strict";a("0f66")},"30d1":function(t,e,a){"use strict";a("b7de")},3935:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{staticStyle:{height:"100%"}},[a("NavigationSelect"),a("AircraftSelect"),a("l-map",{ref:"movingMap",attrs:{options:{zoomSnap:.5}},on:{ready:t.setupMap,contextmenu:function(e){t.nextDestination=e}}},[a("l-base-layer-group"),a("l-control-fullscreen",{attrs:{position:"topleft"}}),a("l-moving-map-toolbox-control",{attrs:{position:"bottomleft"},on:{"delete-track":t.removeLocations},model:{value:t.settings,callback:function(e){t.settings=e},expression:"settings"}}),a("l-moving-map-instruments-control",{attrs:{position:"topright"},model:{value:t.lastKnownLocation,callback:function(e){t.lastKnownLocation=e},expression:"lastKnownLocation"}}),t.lastKnownLocation&&t.nextDestination?a("l-moving-map-destination-control",{attrs:{from:t.lastKnownLocation,to:t.nextDestination,position:"bottomright"}}):t._e(),a("l-location-marker",{attrs:{delay:t.futurPositionDelay},model:{value:t.lastKnownLocation,callback:function(e){t.lastKnownLocation=e},expression:"lastKnownLocation"}}),t.trace?a("l-polyline",{attrs:{"lat-lngs":t.trace,className:"traceLine"}}):t._e(),t._l(t.routes,(function(e,i){return a("l-route-layer-group",{key:i,attrs:{value:e,active:!1},on:{"contextmenu-waypoint":function(a){t.nextDestination=e[a]}}})})),a("l-destination-marker",{attrs:{origin:t.lastKnownLocation},model:{value:t.nextDestination,callback:function(e){t.nextDestination=e},expression:"nextDestination"}})],2)],1)},n=[],o=(a("29ae"),a("6cc5"),a("2699")),s=a("635f"),r=a("c222"),l=a("e11e"),c=a.n(l),u=a("d425");const h={data(){return{maxAccuracy:150,minSpeed:1e3/3600,minDistance:1,geoOptions:{watch:!0,enableHighAccuracy:!0,timeout:5e3,maximumAge:1e3}}},methods:{stopLocate(){this.map.stopLocate()},startLocate(){this.map.locate(this.geoOptions)},_locationFound(t){this._checkAccuracy(t).then(this._checkDistance).catch(this._locationError).then(this._computeFromLastLocation).then(this._checkAltitude).then(this._checkSpeed).then(t=>{const{sourceTarget:e,target:a,bounds:i,latitude:n,longitude:o,...s}=t;return this.lastKnownLocation=s,this.settings.setView&&this.bestView(t),new Promise(t=>{this.settings.inFlight&&t(s)})}).then(t=>(this.setNextDestination,t)).then(this.addLocation)},_locationError(t){return new Promise((e,a)=>{delete t.sourceTarget,delete t.target,this.lastKnownError={...t},this.settings.allowWarning&&this.openWarning(t),a({...t})})},_checkAccuracy(t){return new Promise((e,a)=>{t.accuracy<this.maxAccuracy?e(t):a({...t,type:"locationerror",message:`Geolocation error: low accuracy (${t.accuracy}m)`})})},_checkDistance(t){return new Promise((e,a)=>{this.lastKnownLocation&&t.latlng.distanceTo(this.lastKnownLocation.latlng)<this.minDistance?a({...t,type:"locationerror",message:"Geolocation error: still fixing."}):e(t)})},_checkAltitude(t){return new Promise(e=>{t.altitudeAccuracy<this.maxAccuracy?e(t):e({...t,altitude:void 0,altitudeAccuracy:void 0})})},_checkSpeed(t){return new Promise(e=>{t.speed>this.minSpeed?e(t):e({...t,speed:void 0,heading:void 0})})},_fakeLocation({latlng:t={lat:0,lng:0},accuracy:e=20,altitude:a=1e3},i=5){let n=(t=i)=>(Math.random()-.5)*t;return{type:"locationfaked",latlng:c.a.latLng(t.lat+n(i/100),t.lng+n(i/100)),accuracy:e+n(e*i/100),altitude:a+n(a*i/100),altitudeAccuracy:e+n(e*i/100),timestamp:Date.now()}},_computeFromLastLocation(t){if(this.lastKnownLocation){let e=new u["a"](this.lastKnownLocation.latlng.lat,this.lastKnownLocation.latlng.lng),a=new u["a"](t.latlng.lat,t.latlng.lng);return{heading:e.rhumbBearingTo(a),speed:e.rhumbDistanceTo(a)/(t.timestamp-this.lastKnownLocation.timestamp)*1e3,vario:(this.lastKnownLocation.altitude-t.altitude)/(t.timestamp-this.lastKnownLocation.timestamp)*1e3,...t}}return t}}};var d=a("cd48"),p=a("b4f7"),g=a("b8bf"),m=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("l-control",t._b({},"l-control",t.$attrs,!1),[a("b-field",[a("b-dropdown",{attrs:{position:"is-top-right"}},[a("p",{staticClass:"control",attrs:{slot:"trigger"},slot:"trigger"},[a("button",{staticClass:"button"},[a("b-tooltip",{attrs:{label:"Settings"}},[a("b-icon",{attrs:{icon:"cog-outline"}})],1)],1)]),a("b-dropdown-item",[a("b-switch",{model:{value:t.value.getLocation,callback:function(e){t.$set(t.value,"getLocation",e)},expression:"value.getLocation"}},[t._v("Use GNSS")])],1),a("b-dropdown-item",[a("b-switch",{attrs:{disabled:!t.value.getLocation},model:{value:t.value.setView,callback:function(e){t.$set(t.value,"setView",e)},expression:"value.setView"}},[t._v("Keep view centered")])],1),a("b-dropdown-item",[a("b-switch",{attrs:{disabled:!t.wakeLockable},model:{value:t.value.wakeLock,callback:function(e){t.$set(t.value,"wakeLock",e)},expression:"value.wakeLock"}},[t._v("Keep screen On")])],1),a("b-dropdown-item",[a("b-button",{attrs:{size:"is-small","icon-right":"map-marker-remove-outline",outlined:"",expanded:""},on:{click:function(e){return t.$emit("delete-track")}}},[t._v("Delete trace")])],1),a("b-dropdown-item",[a("b-switch",{model:{value:t.value.allowWarning,callback:function(e){t.$set(t.value,"allowWarning",e)},expression:"value.allowWarning"}},[t._v("Display warnings")])],1)],1),t.value.inFlight?[a("p",{staticClass:"control"},[a("button",{staticClass:"button",on:{click:function(e){t.value.inFlight=!1}}},[a("b-tooltip",{attrs:{label:"Stop"}},[a("b-icon",{attrs:{type:"is-danger",icon:"airplane-landing"}})],1)],1)]),a("p",{staticClass:"control"},[a("button",{staticClass:"button",attrs:{disabled:""}},[a("b-tooltip",{attrs:{label:"Checklist"}},[a("b-icon",{attrs:{icon:"clipboard-list-outline"}})],1)],1)])]:[a("p",{staticClass:"control"},[a("button",{staticClass:"button",on:{click:function(e){return t.$store.commit("navigationSelect",!0)}}},[a("b-tooltip",{attrs:{label:"Select a navigation"}},[a("b-icon",{attrs:{icon:"map-marker-path"}})],1)],1)]),a("p",{staticClass:"control"},[a("button",{staticClass:"button",on:{click:function(e){return t.$store.commit("aircraftSelect",!0)}}},[a("b-tooltip",{attrs:{label:"Select an aircraft"}},[a("b-icon",{attrs:{icon:"airplane"}})],1)],1)]),a("p",{staticClass:"control"},[a("button",{staticClass:"button",on:{click:function(e){t.value.inFlight=!0}}},[a("b-tooltip",{attrs:{label:"Start"}},[a("b-icon",{attrs:{icon:"airplane-takeoff"}})],1)],1)]),a("p",{staticClass:"control"},[a("button",{staticClass:"button",attrs:{disabled:""},on:{click:function(e){return t.$store.commit("traceSelect",!0)}}},[a("b-tooltip",{attrs:{label:"Save trace"}},[a("b-icon",{attrs:{icon:"map-marker-plus-outline"}})],1)],1)])]],2)],1)},b=[],v=a("2253"),f={name:"LMovingMapToolboxControl",components:{LControl:v["a"]},props:{value:{type:Object,default:()=>({getLocation:!0,setView:!0,wakeLock:!0,inFlight:!1,allowWarning:!0})}},computed:{wakeLockable(){return"wakeLock"in navigator&&"visible"===document.visibilityState}},watch:{value:{deep:!0,handler(t){this.$emit("input",t)}}}},w=f,y=a("2877"),L=Object(y["a"])(w,m,b,!1,null,null,null),_=L.exports,k=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("l-control",t._b({},"l-control",t.$attrs,!1),[a("b-field",{attrs:{grouped:"","group-multiline":""}},[a("div",{staticClass:"control"},[a("b-taglist",{attrs:{attached:""}},[a("b-tag",{attrs:{type:"is-primary",size:"is-medium"}},[t._v(t._s(t._f("precision")(t._f("asSpeed")(t.value.speed),0)))]),a("b-tag",{attrs:{type:"is-light",size:"is-medium"}},[t._v("kt")])],1)],1),a("div",{staticClass:"control"},[a("b-taglist",{attrs:{attached:""}},[a("b-tag",{attrs:{type:"is-primary",size:"is-medium"}},[t._v(t._s(t._f("precision")(t._f("asHeading")(t.value.heading),0)))]),a("b-tag",{attrs:{type:"is-light",size:"is-medium"}},[t._v("°")])],1)],1),a("div",{staticClass:"control"},[a("b-taglist",{attrs:{attached:""}},[a("b-tag",{attrs:{type:"is-info",size:"is-medium"}},[t._v(t._s(t._f("precision")(t._f("asAltitude")(t.value.altitude),-1)))]),a("b-tag",{attrs:{type:"is-light",size:"is-medium"}},[t._v("ft")])],1)],1),a("div",{staticClass:"control"},[a("b-taglist",{attrs:{attached:""}},[a("b-tag",{attrs:{type:"is-dark",size:"is-medium"}},[t._v(t._s(t._f("precision")(t._f("asSpeed")(t.value.vario,"ft/min"),-1)))]),a("b-tag",{attrs:{type:"is-light",size:"is-medium"}},[t._v("ft/min")])],1)],1)])],1)},N=[],M=a("08df"),x={name:"LMovingMapInstrumentsControl",components:{LControl:v["a"]},props:{value:{type:Object,default:()=>({speed:null,altitude:null,heading:null,vario:null})}},mixins:[M["c"]]},E=x,$=Object(y["a"])(E,k,N,!1,null,null,null),D=$.exports,S=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("l-control",t._b({},"l-control",t.$attrs,!1),[a("b-field",{attrs:{grouped:"","group-multiline":""}},[a("div",{staticClass:"control"},[a("b-taglist",{attrs:{attached:""}},[a("b-tag",{attrs:{type:"is-success",size:"is-medium"}},[t._v(t._s(t._f("precision")(t._f("asDistance")(t.distance,"NM"),0)))]),a("b-tag",{attrs:{type:"is-light",size:"is-medium"}},[t._v("NM")])],1)],1),a("div",{staticClass:"control"},[a("b-taglist",{attrs:{attached:""}},[a("b-tag",{attrs:{type:"is-info",size:"is-medium"}},[t._v(t._s(t._f("precision")(t._f("asHeading")(t.heading),0)))]),a("b-tag",{attrs:{type:"is-light",size:"is-medium"}},[t._v("°")])],1)],1),a("div",{staticClass:"control"},[a("b-taglist",{attrs:{attached:""}},[a("b-tag",{attrs:{type:"is-light",size:"is-medium"}},[t._v("ETE")]),a("b-tag",{attrs:{type:"is-primary",size:"is-medium"}},[t._v(t._s(t._f("asDuration")(t.ETE)))])],1)],1)])],1)},T=[],C=a("c226"),O=a("9395");const F={WGS84:{a:6378137,b:6356752.314245,f:1/298.257223563}},W={WGS84:{ellipsoid:F.WGS84}};Object.freeze(F.WGS84),Object.freeze(W.WGS84);class K{constructor(t,e,a=0){if(isNaN(t))throw new TypeError(`invalid lat ‘${t}’`);if(isNaN(e))throw new TypeError(`invalid lon ‘${e}’`);if(isNaN(a))throw new TypeError(`invalid height ‘${a}’`);this._lat=C["a"].wrap90(Number(t)),this._lon=C["a"].wrap180(Number(e)),this._height=Number(a)}get lat(){return this._lat}get latitude(){return this._lat}set lat(t){if(this._lat=isNaN(t)?C["a"].wrap90(C["a"].parse(t)):C["a"].wrap90(Number(t)),isNaN(this._lat))throw new TypeError(`invalid lat ‘${t}’`)}set latitude(t){if(this._lat=isNaN(t)?C["a"].wrap90(C["a"].parse(t)):C["a"].wrap90(Number(t)),isNaN(this._lat))throw new TypeError(`invalid latitude ‘${t}’`)}get lon(){return this._lon}get lng(){return this._lon}get longitude(){return this._lon}set lon(t){if(this._lon=isNaN(t)?C["a"].wrap180(C["a"].parse(t)):C["a"].wrap180(Number(t)),isNaN(this._lon))throw new TypeError(`invalid lon ‘${t}’`)}set lng(t){if(this._lon=isNaN(t)?C["a"].wrap180(C["a"].parse(t)):C["a"].wrap180(Number(t)),isNaN(this._lon))throw new TypeError(`invalid lng ‘${t}’`)}set longitude(t){if(this._lon=isNaN(t)?C["a"].wrap180(C["a"].parse(t)):C["a"].wrap180(Number(t)),isNaN(this._lon))throw new TypeError(`invalid longitude ‘${t}’`)}get height(){return this._height}set height(t){if(this._height=Number(t),isNaN(this._height))throw new TypeError(`invalid height ‘${t}’`)}get datum(){return this._datum}set datum(t){this._datum=t}static get ellipsoids(){return F}static get datums(){return W}static parse(...t){if(0==t.length)throw new TypeError("invalid (empty) point");let e=void 0,a=void 0,i=void 0;if("object"==typeof t[0]&&(1==t.length||!isNaN(parseFloat(t[1])))){const n=t[0];if("Point"==n.type&&Array.isArray(n.coordinates)?([a,e,i]=n.coordinates,i=i||0):(void 0!=n.latitude&&(e=n.latitude),void 0!=n.lat&&(e=n.lat),void 0!=n.longitude&&(a=n.longitude),void 0!=n.lng&&(a=n.lng),void 0!=n.lon&&(a=n.lon),void 0!=n.height&&(i=n.height),e=C["a"].wrap90(C["a"].parse(e)),a=C["a"].wrap180(C["a"].parse(a))),void 0!=t[1]&&(i=t[1]),isNaN(e)||isNaN(a))throw new TypeError(`invalid point ‘${JSON.stringify(t[0])}’`)}if("string"==typeof t[0]&&2==t[0].split(",").length&&([e,a]=t[0].split(","),e=C["a"].wrap90(C["a"].parse(e)),a=C["a"].wrap180(C["a"].parse(a)),i=t[1]||0,isNaN(e)||isNaN(a)))throw new TypeError(`invalid point ‘${t[0]}’`);if(void 0==e&&void 0==a&&([e,a]=t,e=C["a"].wrap90(C["a"].parse(e)),a=C["a"].wrap180(C["a"].parse(a)),i=t[2]||0,isNaN(e)||isNaN(a)))throw new TypeError(`invalid point ‘${t.toString()}’`);return new this(e,a,i)}toCartesian(){const t=this.datum?this.datum.ellipsoid:this.referenceFrame?this.referenceFrame.ellipsoid:F.WGS84,e=this.lat.toRadians(),a=this.lon.toRadians(),i=this.height,{a:n,f:o}=t,s=Math.sin(e),r=Math.cos(e),l=Math.sin(a),c=Math.cos(a),u=2*o-o*o,h=n/Math.sqrt(1-u*s*s),d=(h+i)*r*c,p=(h+i)*r*l,g=(h*(1-u)+i)*s;return new z(d,p,g)}equals(t){if(!(t instanceof K))throw new TypeError(`invalid point ‘${t}’`);return!(Math.abs(this.lat-t.lat)>Number.EPSILON)&&(!(Math.abs(this.lon-t.lon)>Number.EPSILON)&&(!(Math.abs(this.height-t.height)>Number.EPSILON)&&(this.datum==t.datum&&(this.referenceFrame==t.referenceFrame&&this.epoch==t.epoch))))}toString(t="d",e,a=null){if(!["d","dm","dms","n"].includes(t))throw new RangeError(`invalid format ‘${t}’`);const i=(this.height>=0?" +":" ")+this.height.toFixed(a)+"m";if("n"==t){void 0==e&&(e=4);const t=this.lat.toFixed(e),n=this.lon.toFixed(e);return`${t}, ${n}${null==a?"":i}`}const n=C["a"].toLat(this.lat,t,e),o=C["a"].toLon(this.lon,t,e);return`${n}, ${o}${null==a?"":i}`}}class z extends O["a"]{constructor(t,e,a){super(t,e,a)}toLatLon(t=F.WGS84){if(!t||!t.a)throw new TypeError(`invalid ellipsoid ‘${t}’`);const{x:e,y:a,z:i}=this,{a:n,b:o,f:s}=t,r=2*s-s*s,l=r/(1-r),c=Math.sqrt(e*e+a*a),u=Math.sqrt(c*c+i*i),h=o*i/(n*c)*(1+l*o/u),d=h/Math.sqrt(1+h*h),p=d/h,g=isNaN(p)?0:Math.atan2(i+l*o*d*d*d,c-r*n*p*p*p),m=Math.atan2(a,e),b=Math.sin(g),v=Math.cos(g),f=n/Math.sqrt(1-r*b*b),w=c*v+i*b-n*n/f,y=new K(g.toDegrees(),m.toDegrees(),w);return y}toString(t=0){const e=this.x.toFixed(t),a=this.y.toFixed(t),i=this.z.toFixed(t);return`[${e},${a},${i}]`}}const P=Math.PI,q=Number.EPSILON;class A extends K{distanceTo(t){try{const e=this.inverse(t).distance;return Number(e.toFixed(3))}catch(e){if(e instanceof EvalError)return NaN;throw e}}initialBearingTo(t){try{const e=this.inverse(t).initialBearing;return Number(e.toFixed(7))}catch(e){if(e instanceof EvalError)return NaN;throw e}}finalBearingTo(t){try{const e=this.inverse(t).finalBearing;return Number(e.toFixed(7))}catch(e){if(e instanceof EvalError)return NaN;throw e}}destinationPoint(t,e){return this.direct(Number(t),Number(e)).point}finalBearingOn(t,e){const a=this.direct(Number(t),Number(e)).finalBearing;return Number(a.toFixed(7))}direct(t,e){if(0!=this.height)throw new RangeError("point must be on the surface of the ellipsoid");const a=this.lat.toRadians(),i=this.lon.toRadians(),n=e.toRadians(),o=t,s=this.datum?this.datum.ellipsoid:K.ellipsoids.WGS84,{a:r,b:l,f:c}=s,u=Math.sin(n),h=Math.cos(n),d=(1-c)*Math.tan(a),p=1/Math.sqrt(1+d*d),g=d*p,m=Math.atan2(d,h),b=p*u,v=1-b*b,f=v*(r*r-l*l)/(l*l),w=1+f/16384*(4096+f*(f*(320-175*f)-768)),y=f/1024*(256+f*(f*(74-47*f)-128));let L=o/(l*w),_=null,k=null,N=null,M=null,x=null,E=0;do{M=Math.cos(2*m+L),_=Math.sin(L),k=Math.cos(L),N=y*_*(M+y/4*(k*(2*M*M-1)-y/6*M*(4*_*_-3)*(4*M*M-3))),x=L,L=o/(l*w)+N}while(Math.abs(L-x)>1e-12&&++E<100);if(E>=100)throw new EvalError("Vincenty formula failed to converge");const $=g*_-p*k*h,D=Math.atan2(g*k+p*_*h,(1-c)*Math.sqrt(b*b+$*$)),S=Math.atan2(_*u,p*k-g*_*h),T=c/16*v*(4+c*(4-3*v)),O=S-(1-T)*c*b*(L+T*_*(M+T*k*(2*M*M-1))),F=i+O,W=Math.atan2(b,-$),z=new A(D.toDegrees(),F.toDegrees(),0,this.datum);return{point:z,finalBearing:C["a"].wrap360(W.toDegrees()),iterations:E}}inverse(t){if(!(t instanceof K))throw new TypeError(`invalid point ‘${t}’`);if(0!=this.height||0!=t.height)throw new RangeError("point must be on the surface of the ellipsoid");const e=this,a=t,i=e.lat.toRadians(),n=e.lon.toRadians(),o=a.lat.toRadians(),s=a.lon.toRadians(),r=this.datum?this.datum.ellipsoid:K.ellipsoids.WGS84,{a:l,b:c,f:u}=r,h=s-n,d=(1-u)*Math.tan(i),p=1/Math.sqrt(1+d*d),g=d*p,m=(1-u)*Math.tan(o),b=1/Math.sqrt(1+m*m),v=m*b,f=Math.abs(h)>P/2||Math.abs(o-i)>P/2;let w=h,y=null,L=null,_=f?P:0,k=0,N=f?-1:1,M=null,x=1,E=null,$=1,D=null,S=null,T=0;do{if(y=Math.sin(w),L=Math.cos(w),M=b*y*(b*y)+(p*v-g*b*L)*(p*v-g*b*L),Math.abs(M)<q)break;k=Math.sqrt(M),N=g*v+p*b*L,_=Math.atan2(k,N),E=p*b*y/k,$=1-E*E,x=0!=$?N-2*g*v/$:0,D=u/16*$*(4+u*(4-3*$)),S=w,w=h+(1-D)*u*E*(_+D*k*(x+D*N*(2*x*x-1)));const t=f?Math.abs(w)-P:Math.abs(w);if(t>P)throw new EvalError("λ > π")}while(Math.abs(w-S)>1e-12&&++T<1e3);if(T>=1e3)throw new EvalError("Vincenty formula failed to converge");const O=$*(l*l-c*c)/(c*c),F=1+O/16384*(4096+O*(O*(320-175*O)-768)),W=O/1024*(256+O*(O*(74-47*O)-128)),z=W*k*(x+W/4*(N*(2*x*x-1)-W/6*x*(4*k*k-3)*(4*x*x-3))),A=c*F*(_-z),B=Math.abs(M)<q?0:Math.atan2(b*y,p*v-g*b*L),V=Math.abs(M)<q?P:Math.atan2(p*y,-g*b+p*v*L);return{distance:A,initialBearing:Math.abs(A)<q?NaN:C["a"].wrap360(B.toDegrees()),finalBearing:Math.abs(A)<q?NaN:C["a"].wrap360(V.toDegrees()),iterations:T}}}var B={name:"LMovingMapDestinationControl",components:{LControl:v["a"]},props:{from:Object,to:Object},mixins:[M["c"]],computed:{distance(){return this.from.latlng.distanceTo(this.to.latlng)},ETE(){return this.distance/this.from.speed},heading(){return this.latlon(this.from).initialBearingTo(this.latlon(this.to))},relative_bearing(){return this.heading-this.from.heading},vertical_speed(){return(this.to.altitude-this.from.altitude)/this.ETE}},methods:{latlon(t){return new A(t.latlng.lat,t.latlng.lng)}}},V=B,j=Object(y["a"])(V,S,T,!1,null,null,null),G=j.exports,R=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("l-layer-group",[t.value.latlng?a("l-marker",{attrs:{"lat-lng":t.value.latlng}},[a("l-icon",{attrs:{"class-name":"leaflet-diamond-icon"}},[a("div")])],1):t._e(),t.value.latlng&&t.value.accuracy?a("l-circle",{attrs:{"lat-lng":t.value.latlng,radius:t.value.accuracy,className:"accuracyCircle"}}):t._e(),this.value.latlng&&this.value.heading&&this.value.speed?a("l-polyline",{attrs:{"lat-lngs":t.speedVector,className:"speedVector"}}):t._e()],1)},I=[],H=a("1ebb"),J=a("4e2b6"),U=a("fbba"),Q=a("0dbd"),X={name:"LLocationMarker",components:{LLayerGroup:H["a"],LMarker:J["a"],LIcon:U["a"],LPolyline:s["a"],LCircle:Q["a"]},props:{value:{type:Object,default:()=>({latlng:null,speed:null,heading:null,accuracy:null})},delay:{type:Number,default:()=>60}},computed:{speedVector(){return[this.value.latlng,new u["a"](this.value.latlng.lat,this.value.latlng.lng).rhumbDestinationPoint(this.value.speed*this.delay,this.value.heading)]}}},Y=X,Z=(a("0223"),Object(y["a"])(Y,R,I,!1,null,null,null)),tt=Z.exports,et=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.origin&&t.value?a("span",[a("l-layer-group",[a("l-marker",{attrs:{"lat-lng":t.value.latlng},on:{contextmenu:function(e){return t.$emit("input")}}},[a("l-icon",{attrs:{"class-name":"leaflet-destination-icon"}},[a("div")])],1),a("l-polyline",{attrs:{"lat-lngs":t.destinationVector,className:"destinationVector"}})],1)],1):t._e()},at=[],it=a("ef62"),nt={name:"LDestinationMarker",components:{LLayerGroup:H["a"],LMarker:J["a"],LIcon:U["a"],LPolyline:s["a"]},props:["value","origin"],mounted(){this.map=Object(it["d"])(this.$parent,!0).mapObject},computed:{destinationVector(){return[this.origin.latlng,this.value.latlng]}}},ot=nt,st=(a("1849"),Object(y["a"])(ot,et,at,!1,null,null,null)),rt=st.exports,lt=a("4b61"),ct={name:"MovingMap",components:{NavigationSelect:d["a"],AircraftSelect:p["a"],LMap:o["a"],LControlFullscreen:r["a"],LPolyline:s["a"],LBaseLayerGroup:g["a"],LMovingMapToolboxControl:_,LMovingMapInstrumentsControl:D,LMovingMapDestinationControl:G,LLocationMarker:tt,LRouteLayerGroup:lt["a"],LDestinationMarker:rt},mixins:[h],data(){return{lastKnownLocation:void 0,lastKnownError:void 0,nextDestination:void 0,wakeLock:null,traceDB:"navue_trace",traceType:"location",futurPositionDelay:180,minDestination:100,settings:{getLocation:!0,setView:!0,wakeLock:!0,inFlight:!1,allowWarning:!0}}},mounted(){this.requestWakeLock(),document.addEventListener("visibilitychange",this.requestWakeLock)},beforeDestroy(){this.stopLocate(),document.removeEventListener("visibilitychange",this.requestWakeLock),this.wakeLock&&this.wakeLock.release()},computed:{map(){return this.$refs.movingMap.mapObject},routes(){try{return this.$store.state.currentNavigation.routes}catch{return null}},trace(){return(this.reportedLocations||[]).filter(t=>!!t.latlng).map(t=>t.latlng)}},watch:{"settings.setView":function(t){t&&this.lastKnownLocation&&this.bestView(this.lastKnownLocation)},"settings.wakeLock":function(t){t&&this.requestWakeLock(),!t&&this.wakeLock&&this.wakeLock.release()},"settings.getLocation":{handler(t){t?this.startLocate():this.stopLocate()}}},pouch:{reportedLocations(){return{database:this.traceDB,selector:{type:this.traceType}}}},methods:{setupMap(t){t.on("locationfound",this._locationFound,this).on("locationerror",this._locationError,this),this.settings.getLocation&&this.startLocate()},bestView(t){this.map.flyToBounds(t.latlng.toBounds(t.speed?t.speed*this.futurPositionDelay:t.accuracy).pad(.1))},addLocation(t){return this.$pouch.post({...t,type:"location",_id:t.timestamp.toString()},{},this.traceDB)},removeLocations(){this.$pouch.destroy(this.traceDB).then(()=>{let t=this.traceType;this.traceType=null,this.traceType=t}).catch(console.error)},setNextDestination(t){this.nextDestination&&t.latlng.distanceTo(this.nextDestination.latlng)<this.minDestination&&(this.routes?this.nextDestination=this.getNextWaypoint(this.routes,this.nextDestination):this.nextDestination=null)},getNextWaypoint(t,e){let a=t.findIndex(t=>t.indexOf(e)>-1);if(a>-1){let i=t[a],n=i.indexOf(e);if(i.length-1>n)return i[n+1]}return null},async requestWakeLock(){try{if(!("wakeLock"in navigator)||"visible"!==document.visibilityState)throw"wakelock unavaliable";this.wakeLock=await navigator.wakeLock.request("screen")}catch(t){this.settings.wakeLock=!1}},openWarning(t){this.$buefy.snackbar.open({message:t.message,position:"is-bottom",type:"is-danger",duration:5e3,actionText:"Deactivate",onAction:()=>{this.settings.allowWarning=!1,this.$buefy.toast.open({message:"Warnings Deactivated",queue:!1})}})}}},ut=ct,ht=(a("30d1"),Object(y["a"])(ut,i,n,!1,null,null,null));e["default"]=ht.exports},ae67:function(t,e,a){},b7de:function(t,e,a){}}]);