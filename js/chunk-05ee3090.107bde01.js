(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-05ee3090"],{"0f00":function(t,e,i){},"123f":function(t,e,i){"use strict";var n=i("2da0"),s=i.n(n);s.a},"263c":function(t,e,i){"use strict";var n=i("c105"),s=i.n(n);s.a},"2da0":function(t,e,i){},"3e8f":function(t,e,i){"use strict";var n=i("847f"),s=i.n(n);s.a},"690b":function(t,e,i){"use strict";var n=i("0f00"),s=i.n(n);s.a},"847f":function(t,e,i){},c105:function(t,e,i){},ef23:function(t,e,i){"use strict";i.r(e);var render=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("section",{staticStyle:{height:"100%"}},[i("l-map",t._b({ref:"movingMap",on:{ready:t.setupMap,contextmenu:t.setDestination}},"l-map",t.settings.map,!1),[i("l-control",{attrs:{position:"topleft"}},[i("b-field",{staticClass:"is-stackable",attrs:{addons:""}},[i("MovingMapSettings",t._b({attrs:{position:"is-bottom-right",triggers:["click","hover"]},on:{"update:settings":t.updateSettings}},"MovingMapSettings",t.settings,!1)),t.settings.inFlight?t._e():i("DataToolbar",{attrs:{navigation:"",aircraft:"",flight:{persistent:!0,trace:t.traceDB},dropdown:{position:"is-bottom-right",triggers:["click","hover"]}}})],1)],1),t.settings.zoomControl?i("l-control-zoom",{attrs:{position:"topleft"}}):t._e(),i("l-control",{attrs:{position:"bottomleft"}},[i("ReportToolbar",{staticClass:"is-stackable",attrs:{tooltip:{position:"is-top"},navlog:"",checklists:"",vac:"",weather:"",aip:"",notepad:""}})],1),i("l-control",{attrs:{position:"topright"}},[i("InstrumentsDisplay",t._b({staticClass:"is-stackable"},"InstrumentsDisplay",t.currentLocation,!1))],1),i("l-control",{attrs:{position:"bottomright"}},[i("TimerToolbar",{on:{"update:settings":t.updateSettings}})],1),i("l-base-layer-group"),i("l-location-marker",{attrs:{"v-if":t.currentLocation,value:t.currentLocation,unsure:!!t.lastError,delay:t.settings.futurPositionDelay}}),i("l-polyline",{attrs:{"lat-lngs":t.trace,className:"traceLine"}}),t._l(t.routes,(function(e,n){return i("l-route-layer-group",{key:n,attrs:{value:e.items,active:!1},on:{"contextmenu-waypoint":function(i){return t.setDestination(e.items[i])}}})})),i("l-destination-marker",{attrs:{to:t.currentDestination,from:t.currentLocation},on:{update:function(e){t.currentDestination=e}}})],2)],1)},n=[],s=(i("29ae"),i("6cc5"),i("2699")),a=i("c8b6"),o=i("2253"),r=i("635f"),l=i("f9de"),c=i("08df");const u={mixins:[c["c"]],data(){return{lastError:void 0,geoOptions:{enableHighAccuracy:!0,timeout:5e3,maximumAge:1e3},settings:{maxAccuracy:150,minSpeed:.2,minDistance:1}}},beforeDestroy(){this.stopLocate()},methods:{stopLocate(){this.currentLocation=void 0,navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId)},startLocate(){if(!("geolocation"in navigator))return this._locationError({code:0,message:"Geolocation not supported by your device."}),this;this._locationWatchId=navigator.geolocation.watchPosition(this._locationFound,this._locationError,this.geoOptions)},_locationFound(t){let e=l["a"].fromGeolocationPosition(t);e.accuracy>this.settings.maxAccuracy?this._locationError({location:e,code:99,message:`Geolocation error: too low accuracy (${e.accuracy})`}):this.currentLocation instanceof l["a"]&&e.distanceTo(this.currentLocation)<=this.settings.minDistance||(e.altitude&&e.altitude.accuracy>this.settings.maxAccuracy&&(e.altitude=void 0),e.speed<this.settings.minSpeed&&(e.speed=void 0,e.heading=void 0),this.lastError=void 0,this.currentLocation=e)},_locationError({message:t,code:e}){switch(e){case 0:case 1:t="You should grant location access in order use these feature. Please change your browser settings";break;case 2:t="Your device can't find your position right now.";break;case 3:t="Last known position too old.";break}this.settings.inFlight&&this.lastError==e&&this.newLeg(),this.lastError=e,this.openWarning({message:t,actionText:"Stop GNSS",onAction:()=>this.settings.getLocation=!1})},_fakeLocation({latitude:t=0,longitude:e=0,accuracy:i=20,altitude:n=1e3,speed:s=50,heading:a=0}){console.debug("Faking around");let rand=(t=1)=>(Math.random()-.5)*t;return{latitude:t+rand(.3),longitude:e+rand(.3),accuracy:i+rand(),altitude:n+rand(100),altitudeAccuracy:i+rand(),heading:a+rand(180),speed:s+rand(),timestamp:Date.now()}}}},d={data(){return{traceDB:"navue_trace",traceType:"Location",trace:[],settings:{traceLength:250}}},async created(){this.setTrace(this.$pouch.getDB(this.traceDB))},beforeDestroy(){this.traceFeed.cancel()},methods:{async setTrace(t){this.trace=await this.getTrace(t),this.traceFeed=t.on("destroyed",e=>{e&&(this.traceFeed.cancel(),this.traceFeed=this.setTrace(this.$pouch.getDB(t.name)))}).changes({since:"now",live:!0,include_docs:!0}).on("change",({doc:{latitude:t,longitude:e}})=>{this.trace[0]&&t&&e?this.trace[0].unshift([t,e]):this.trace.unshift([])})},getTrace(t){return t.query({map:({_id:t,latitude:e,longitude:i},n)=>{e&&i&&n(t.split("-")[0],[e,i])},reduce:(t,e)=>e},{group:!0,limit:this.traceLength}).then(({rows:t})=>t.reduce((t,e)=>(t.unshift(e.value),t),[]))}}},h={data(){return{currentDestination:void 0,settings:{minDestination:100,futurPositionDelay:3}}},methods:{setDestination({latlng:t,latitude:e,longitude:i,altitude:n}={}){this.currentDestination=l["b"].from({latlng:t,latitude:e,longitude:i,altitude:n,type:"Waypoint"})},getDestination(t){this.destination&&t.distanceTo(this.destination)<this.settings.minDestination&&(this.currentDestination=this.navigation.getNextWaypoint(this.currentDestination))}}};var MovingMapSettingsvue_type_template_id_490f6bb4_render=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("b-dropdown",t._b({},"b-dropdown",t.$attrs,!1),[i("b-button",{attrs:{slot:"trigger"},slot:"trigger"},[i("b-icon",{attrs:{icon:"cog-outline"}})],1),i("b-dropdown-item",{attrs:{custom:""}},[i("b-switch",{attrs:{value:t.getLocation},on:{input:function(e){return t.$emit("update:settings",{getLocation:e})}}},[t._v("Use GNSS")])],1),i("b-dropdown-item",{attrs:{custom:""}},[i("b-switch",{attrs:{value:t.setView,disabled:!t.getLocation},on:{input:function(e){return t.$emit("update:settings",{setView:e})}}},[t._v("Keep view centered")])],1),i("b-dropdown-item",{attrs:{custom:""}},[i("b-switch",{attrs:{value:t.fullScreen},on:{input:function(e){return t.$emit("update:settings",{fullScreen:e})}}},[t._v("Set Map Fullscreen")])],1),i("b-dropdown-item",{attrs:{custom:""}},[i("b-switch",{attrs:{value:t.zoomControl},on:{input:function(e){return t.$emit("update:settings",{zoomControl:e})}}},[t._v("Display zoom control")])],1),i("b-dropdown-item",{attrs:{separator:""}}),i("b-dropdown-item",{attrs:{custom:""}},[i("b-field",{attrs:{label:"Trace length"}},[i("b-numberinput",{attrs:{size:"is-small","controls-position":"compact",editable:!1,step:"50",min:"10",value:t.traceLength},on:{input:function(e){return t.$emit("update:settings",{traceLength:e})}}})],1)],1),i("b-dropdown-item",{attrs:{custom:""}},[i("b-field",{attrs:{label:"Futur postition delay (min.)"}},[i("b-numberinput",{attrs:{size:"is-small","controls-position":"compact",editable:!1,step:"1",min:"0",value:t.futurPositionDelay},on:{input:function(e){return t.$emit("update:settings",{futurPositionDelay:e})}}})],1)],1),i("b-dropdown-item",{attrs:{custom:""}},[i("b-field",{attrs:{label:"Max. accuracy allowed"}},[i("b-numberinput",{attrs:{size:"is-small","controls-position":"compact",editable:!1,step:"10",min:"1",value:t.maxAccuracy},on:{input:function(e){return t.$emit("update:settings",{maxAccuracy:e})}}})],1)],1),i("b-dropdown-item",{attrs:{custom:""}},[i("b-field",{attrs:{label:"Min. spd allowed"}},[i("b-numberinput",{attrs:{size:"is-small","controls-position":"compact",editable:!1,step:".05",min:"0",value:t.minSpeed},on:{input:function(e){return t.$emit("update:settings",{minSpeed:e})}}})],1)],1),i("b-dropdown-item",{attrs:{custom:""}},[i("b-field",{attrs:{label:"Min. dist. allowed"}},[i("b-numberinput",{attrs:{size:"is-small","controls-position":"compact",editable:!1,step:"1",min:"0",value:t.minDistance},on:{input:function(e){return t.$emit("update:settings",{minDistance:e})}}})],1)],1),i("b-dropdown-item",{attrs:{custom:""}},[i("b-field",{attrs:{label:"Min. destination dist."}},[i("b-numberinput",{attrs:{size:"is-small","controls-position":"compact",editable:!1,step:"10",min:"1",value:t.minDestination},on:{input:function(e){return t.$emit("update:settings",{minDestination:e})}}})],1)],1)],1)},m=[],p={name:"MovingMapSettingsControl",props:{getLocation:Boolean,setView:Boolean,fullScreen:Boolean,zoomControl:Boolean,traceLength:Number,futurPositionDelay:Number,maxAccuracy:Number,minSpeed:Number,minDistance:Number,minDestination:Number,inFlight:Boolean}},g=p,f=i("2877"),b=Object(f["a"])(g,MovingMapSettingsvue_type_template_id_490f6bb4_render,m,!1,null,null,null),v=b.exports,InstrumentsDisplayvue_type_template_id_08875cc9_render=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("b-taglist",[t.speed?i("b-tag",{attrs:{type:"is-primary",size:"is-medium"}},[t._v(t._s(t._f("as")(t.speed,"kt",3)))]):t._e(),t.heading?i("b-tag",{attrs:{type:"is-success",size:"is-medium"}},[t._v(t._s(t._f("as")(t.heading,"Â°",3)))]):t._e(),t.altitude?i("b-tag",{attrs:{type:"is-info",size:"is-medium"}},[t._v(t._s(t._f("as")(t.altitude,"ft",3)))]):t._e(),t.linkHealth>=0?i("b-tag",{attrs:{type:"is-dark",size:"is-medium"}},[i("b-icon",{attrs:{icon:"wifi-strength-"+(t.linkHealth>0?t.linkHealth:"alert-outline")}})],1):t._e()],1)},y=[],L=i("2e0e"),_=i("3634"),w={name:"InstrumentsDisplay",mixins:[L["a"]],props:{speed:_["g"],heading:_["b"],altitude:_["a"]},data(){return{linkStatus:void 0,linkHealth:void 0,goodBandwidth:10,stepsBandwith:4}},mounted(){navigator.connection&&(this.setLink({currentTarget:navigator.connection}),navigator.connection.addEventListener("change",this.setLink))},beforeDestroy(){navigator.connection&&navigator.connection.removeEventListener("change",this.setLink)},methods:{setLink({currentTarget:t}){this.linkHealth=Math.round(Math.min(t.downlink,this.goodBandwidth)/this.goodBandwidth*this.stepsBandwith)}}},D=w,k=Object(f["a"])(D,InstrumentsDisplayvue_type_template_id_08875cc9_render,y,!1,null,null,null),T=k.exports,TimerToolbarvue_type_template_id_7c71a844_scoped_true_render=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.flight?i("nav",{staticClass:"level is-mobile box"},[i("div",{staticClass:"level-item has-text-centered"},[i("div",{staticClass:"is-clickable",on:{click:function(e){!t.isEnroute&&t.startFlight()},contextmenu:function(e){e.preventDefault(),e.stopPropagation(),t.isEnroute&&t.stopFlight()}}},[i("p",{staticClass:"heading"},[i("b-icon",{attrs:{type:t.isEnroute?"is-danger":"is-primary",icon:t.isEnroute?"airplane-landing":"airplane-takeoff"}})],1),i("p",{staticClass:"subtitle"},[t._v(" "+t._s(t._f("asDuration")(t.flightDuration))+" ")])])]),i("div",{staticClass:"level-item has-text-centered"},[i("div",{staticClass:"is-clickable",on:{click:t.startChrono,contextmenu:function(e){return e.preventDefault(),e.stopPropagation(),t.stopChrono(e)}}},[i("p",{staticClass:"heading"},[i("b-icon",{attrs:{icon:"timer-outline",type:t.chronoTime?"is-danger":"is-primary"}})],1),i("p",{staticClass:"subtitle "},[t._v(" "+t._s(t._f("asDuration")(t.chrono))+" ")])])]),i("div",{staticClass:"level-item has-text-centered"},[i("div",{staticClass:"is-clickable",on:{click:function(e){return e.stopPropagation(),t.addTime(e)},contextmenu:function(e){return e.preventDefault(),e.stopPropagation(),t.removeTime(e)}}},[i("p",{staticClass:"heading"},[i("b-icon",{attrs:{icon:"alarm-plus"}})],1),i("div",{staticClass:"timelist"},[i("ul",t._l(t.flight.milestones,(function(e,n){return i("li",{key:n},[t._v(" "+t._s(t._f("asDuration")(e))+" ")])})),0),i("span",{staticClass:"subtitle"},[t._v(" - ")])])])])]):t._e()},x=[],C={name:"TimerToolbar",mixins:[L["a"]],data(){return{currentTime:void 0,currentUpdater:void 0,chronoTime:void 0,finishedAt:null,startedAt:null}},mounted(){this.currentUpdater=setInterval(()=>{this.currentTime=new Date},1e3)},destroyed(){clearInterval(this.currentUpdater)},computed:{isEnroute(){return!!this.startedAt&&!this.finishedAt},flightDuration(){return this.finishedAt?this.finishedAt-this.startedAt:this.startedAt?Math.max(0,this.currentTime-this.startedAt):null},chrono(){return this.chronoTime?Math.max(0,this.currentTime-this.chronoTime):null},timesCount(){return this.milestones.length},flight(){return this.$store.state.currentFlight}},methods:{startFlight(){this.finishedAt=void 0,this.startedAt=new Date,this.$emit("update:settings",{inFlight:this.isEnroute})},stopFlight(){this.finishedAt=new Date,this.$emit("update:settings",{inFlight:this.isEnroute})},startChrono(){this.chronoTime=new Date},stopChrono(){this.chronoTime=void 0},addTime(){this.flight.milestones.unshift(new Date)},removeTime(){this.flight.milestones.shift()}}},M=C,S=(i("690b"),Object(f["a"])(M,TimerToolbarvue_type_template_id_7c71a844_scoped_true_render,x,!1,null,"7c71a844",null)),$=S.exports,E=i("0592"),F=i("8f42"),A=i("a75e"),LLocationMarkervue_type_template_id_041e246e_render=function(){var t=this,e=t.$createElement,i=t._self._c||e;return this.value&&this.value.latlng?i("l-layer-group",[i("l-marker",{attrs:{"lat-lng":t.value.latlng}},[i("l-icon",{attrs:{"class-name":"leaflet-diamond-icon"}},[i("div")])],1),t.value.accuracy?i("l-circle",{attrs:{"lat-lng":t.value.latlng,radius:t.value.accuracy.value,className:"accuracyCircle"}}):t._e(),t.value.heading&&t.value.speed?[i("l-polyline",{attrs:{"lat-lngs":t.speedVector,className:"speedVector"}}),t._l(t.delay,(function(e){return i("l-marker",{key:e,attrs:{"lat-lng":t.nMinutesPosition(e)}},[i("l-icon",{attrs:{"class-name":"leaflet-number-icon",iconSize:["1em","1em"]}},[i("div",[t._v(t._s(e))])])],1)}))]:t._e()],2):t._e()},z=[],B=i("1ebb"),N=i("4e2b"),P=i("fbba"),O=i("0dbd"),V={name:"LLocationMarker",components:{LLayerGroup:B["a"],LMarker:N["a"],LIcon:P["a"],LPolyline:r["a"],LCircle:O["a"]},props:{value:{type:Object,default:()=>({latlng:null,speed:null,heading:null,accuracy:null})},delay:{type:Number,default:()=>3}},computed:{speedVector(){return[this.value.latlng,this.nMinutesPosition(this.delay)]}},methods:{nMinutesPosition(t){return this.value.positionInSeconds(60*t).latlng}}},I=V,j=(i("3e8f"),Object(f["a"])(I,LLocationMarkervue_type_template_id_041e246e_render,z,!1,null,null,null)),G=j.exports,LDestinationMarkervue_type_template_id_392c2c44_render=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.from&&t.to?i("span",[i("l-layer-group",[i("l-marker",{attrs:{"lat-lng":t.to.latlng},on:{contextmenu:function(e){return t.$emit("update")}}},[i("l-icon",{attrs:{"class-name":"leaflet-destination-icon"}},[i("div")])],1),i("l-polyline",{attrs:{"lat-lngs":[t.from.latlng,t.to.latlng],className:"destinationVector"}},[i("l-tooltip",{key:[t.to.latlng,t.from.latlng],attrs:{options:{className:"routeLabel",direction:"center",permanent:!0}}},[t._v(" "+t._s(t.bearing)+" | "+t._s(t._f("asDuration")(t.ETE,1e3))+" | "+t._s(t._f("as")(t.distance,"NM",3))+" ")])],1)],1)],1):t._e()},W=[],H=i("31dc"),J={name:"LDestinationMarker",components:{LLayerGroup:B["a"],LMarker:N["a"],LIcon:P["a"],LTooltip:H["a"],LPolyline:r["a"]},props:{from:Object,to:Object},mixins:[L["a"]],computed:{destinationVector(){return[this.from.latlng,this.to.latlng]},distance(){return this.from.distanceTo(this.to,{precision:3})},ETE(){return this.distance/this.from.speed},bearing(){return this.from.bearingTo(this.to,{precision:3})}}},U=J,q=(i("263c"),Object(f["a"])(U,LDestinationMarkervue_type_template_id_392c2c44_render,W,!1,null,null,null)),R=q.exports,Y=i("2cec"),K={name:"MovingMap",components:{LMap:s["a"],LControlZoom:a["a"],LControl:o["a"],LPolyline:r["a"],MovingMapSettings:v,InstrumentsDisplay:T,TimerToolbar:$,ReportToolbar:E["a"],DataToolbar:F["a"],LBaseLayerGroup:A["a"],LLocationMarker:G,LRouteLayerGroup:Y["a"],LDestinationMarker:R},mixins:[c["d"],u,d,h],data(){return{legStart:void 0,settings:{getLocation:!0,setView:!0,fullScreen:!!document.fullscreenElement,zoomControl:!1,inFlight:!1,map:{zoom:10,center:{lat:42.69597591582309,lng:2.879308462142945},options:{zoomSnap:.1,zoomControl:!1,attributionControl:!1}}}}},computed:{map(){return this.$refs.movingMap.mapObject},navigation(){return this.$store.state.currentNavigation},routes(){return this.navigation?this.navigation.routes:[]},currentLocation:{get(){return this.$store.state.currentLocation},set(t){this.$store.commit("currentLocation",t)}},flight:{get(){return this.$store.state.currentFlight},set(t){this.$store.commit("currentFlight",t)}}},watch:{"settings.setView":function(t){t&&this.currentLocation&&this.bestView(this.currentLocation)},"settings.fullScreen":function(t){this.toggleFullscreen(this.map.getContainer(),t)},"settings.getLocation":function(t){t?this.startLocate():this.stopLocate()},"settings.inFlight":function(t){t&&(this.newLeg(),this.addLocation(this.currentLocation)),this.settings.fullScreen=t},navigation(t){try{let e=t.toBounds();this.map.flyToBounds(e,{padding:[25,25]})}catch{}},currentLocation(t){if(t&&this.settings.setView&&this.bestView(t),t&&this.settings.inFlight&&this.addLocation(t),t&&this.navigation){let e=this.getDestination(t);e&&this.setDestination(e)}}},methods:{newLeg(){this.trace.unshift([]),this.legStart=Date.now()},setupMap(){this.settings.getLocation&&this.startLocate()},bestView(t){let e=t.toBounds(t.speed?t.speed*this.settings.futurPositionDelay*60*2:t.accuracy);this.map.flyToBounds(e,{padding:[25,25]})},addLocation(t){let e=JSON.parse(JSON.stringify(t));return e._id=`${this.legStart}-${t.timestamp}`,this.$pouch[this.traceDB].put(e)},updateSettings(t){this.settings={...this.settings,...t}},toggleFullscreen(t,e){void 0==e?document.fullscreenElement?document.exitFullscreen():t.requestFullscreen():e?t.requestFullscreen():document.exitFullscreen()}}},Z=K,Q=(i("123f"),Object(f["a"])(Z,render,n,!1,null,null,null));e["default"]=Q.exports}}]);