<template>
  <b-taglist v-if="parameters">
    <b-tag type="is-primary" size="is-medium">{{
      parameters.speed | as("kt", 2)
    }}</b-tag>
    <b-tag type="is-success" size="is-medium">{{
      parameters.heading | as("Â°", 2)
    }}</b-tag>
    <b-tag type="is-info" size="is-medium">{{
      parameters.altitude | as("ft", 2)
    }}</b-tag>
    <b-tag type="is-dark" size="is-medium" v-if="linkStatus">
      <b-icon
        :icon="
          linkStatus > 0 ? `wifi-strength-${linkStatus}` : 'wifi-strength-off'
        "
      />
    </b-tag>
  </b-taglist>
</template>

<script>
import UnitSystem from "@/mixins/UnitSystem";
import { Location } from "@/models/Waypoint.js";

export default {
  name: "InstrumentsDisplay",
  mixins: [UnitSystem],
  props: { parameters: Location },
  data() {
    return {
      linkStatus: undefined
    };
  },
  /* eslint-disable compat/compat */
  mounted() {
    if (navigator.connection) {
      this.setLink({ currentTarget: navigator.connection });
      navigator.connection.addEventListener("change", this.setLink);
    }
  },
  beforeDestroy() {
    if (navigator.connection)
      navigator.connection.removeEventListener("change", this.setLink);
  },
  methods: {
    setLink({ currentTarget }) {
      if (currentTarget.downlink && currentTarget.downlinkMax)
        this.linkStatus = Math.round(
          (currentTarget.downlink / currentTarget.downlinkMax) * 4
        );
      if (currentTarget.downlink && !currentTarget.downlinkMax)
        this.linkStatus = Math.min(
          Math.round((currentTarget.downlink / 5) * 4),
          4
        );
    }
  }
};
</script>
